import{d as e,r as a,q as s,M as t,N as l,s as n,c as u,b as o,i as c,o as i,e as r,S as d,h as v,a as m,F as f,j as g,l as p,f as _,g as h,t as y,I as w}from"./index-VE_HmMG4.js";import{a as I,_ as b}from"./_plugin-vue_export-helper.B_VXoL-J.js";import{u as x}from"./user.DucKNo_G.js";const S=b(e({__name:"chat",setup(e){const b=a([]),S=a(""),j=a(""),k=a(""),A=a(""),M=x();async function V(){try{const e=await I.dating.messages(j.value,k.value);b.value=e,l(()=>{b.value.length>0&&(A.value="msg-"+b.value[b.value.length-1].id)})}catch(e){n({title:e.message||"åŠ è½½å¤±è´¥",icon:"none"})}}async function C(){if(!S.value.trim())return;const e=S.value;S.value="";try{await I.dating.sendMessage({senderId:j.value,receiverId:k.value,content:e}),await V()}catch(a){S.value=e,n({title:a.message||"å‘é€å¤±è´¥",icon:"none"})}}function U(e){const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`}return s(()=>{var e,a,s;const l=t(),n=l[l.length-1];k.value=(null==(e=n.options)?void 0:e.otherUserId)||(null==(a=n.options)?void 0:a.userId)||"",j.value=(null==(s=M.userInfo)?void 0:s.id)||"",k.value&&(V(),async function(){try{await I.dating.markAllAsRead(k.value)}catch(e){console.error("æ ‡è®°å·²è¯»å¤±è´¥:",e)}}())}),(e,a)=>{const s=_,t=c,l=d,n=w;return i(),u(t,{class:"chat-page"},{default:o(()=>[r(l,{class:"messages-container","scroll-y":"","scroll-into-view":A.value,"scroll-with-animation":!0},{default:o(()=>[r(t,{class:"messages-list"},{default:o(()=>[(i(!0),v(f,null,g(b.value,e=>(i(),u(t,{key:e.id,class:p(["message-item",{own:e.senderId===j.value}])},{default:o(()=>[r(t,{class:"message-bubble"},{default:o(()=>[r(s,{class:"message-text"},{default:o(()=>[h(y(e.content),1)]),_:2},1024)]),_:2},1024),r(s,{class:"message-time"},{default:o(()=>[h(y(U(e.createdAt)),1)]),_:2},1024)]),_:2},1032,["class"]))),128)),0===b.value.length?(i(),u(t,{key:0,class:"empty-state"},{default:o(()=>[r(s,{class:"empty-icon"},{default:o(()=>[h("ğŸ’¬")]),_:1}),r(s,{class:"empty-text"},{default:o(()=>[h("å¼€å§‹èŠå¤©å§")]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1},8,["scroll-into-view"]),r(t,{class:"input-container"},{default:o(()=>[r(t,{class:"input-wrapper"},{default:o(()=>[r(n,{class:"message-input",modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),placeholder:"è¯´ç‚¹ä»€ä¹ˆ...","confirm-type":"send",onConfirm:C},null,8,["modelValue"]),r(t,{class:"send-btn",onClick:C},{default:o(()=>[r(s,{class:"send-icon"},{default:o(()=>[h("å‘é€")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-dbeafb4e"]]);export{S as default};
