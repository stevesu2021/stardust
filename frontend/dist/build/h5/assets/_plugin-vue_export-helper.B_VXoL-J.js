import{Z as e,P as t,_ as r}from"./index-VE_HmMG4.js";const a="undefined"!=typeof window,o="/api";function d(t){var d;const{url:s,method:l="GET",data:u,header:n}=t;let i="";try{i=a?localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")||"{}").token:"":(null==(d=e("user"))?void 0:d.token)||""}catch(h){}const m={"Content-Type":"application/json",...n};return i&&(m.Authorization=`Bearer ${i}`),new Promise((e,t)=>{r({url:o+s,method:l,data:u,header:m,timeout:6e5,success:r=>{if(200===r.statusCode||201===r.statusCode)e(r.data);else{console.log("[API] Non-200 response:",{url:s,statusCode:r.statusCode,dataType:typeof r.data,data:r.data,dataKeys:r.data?Object.keys(r.data):null});let e="请求失败";"string"==typeof r.data?e=r.data:r.data&&r.data.message?e=r.data.message:r.data&&r.data.error?e=r.data.error:r.data&&(e=JSON.stringify(r.data)),console.log("[API] Extracted error message:",e);const a=new Error(e);a.statusCode=r.statusCode,a.data=r.data,t(a)}},fail:e=>{console.log("[API] Request failed:",e);let r="网络请求失败";e.errMsg&&(r=e.errMsg);const a=new Error(r);a.originalError=e,t(a)}})})}const s={auth:{register:e=>d({url:"/auth/register",method:"POST",data:e}),login:e=>d({url:"/auth/login",method:"POST",data:e}),wechatLogin:e=>d({url:"/auth/wechat/login",method:"POST",data:e}),bindWechat:e=>d({url:"/auth/wechat/bind",method:"POST",data:e}),unbindWechat:()=>d({url:"/auth/wechat/unbind",method:"POST"}),getProfile:()=>d({url:"/auth/profile",method:"GET"})},astrology:{calculate:e=>d({url:`/astrology/calculate/${e}`,method:"POST"}),generateInterpretation:()=>d({url:"/astrology/interpret",method:"POST"}),getReading:()=>d({url:"/astrology/reading",method:"GET"}),getRemainingAttempts:()=>d({url:"/astrology/interpret/remaining",method:"GET"})},prayer:{create:e=>d({url:"/prayer",method:"POST",data:e}),list:e=>d({url:`/prayer/user/${e}`,method:"GET"}),public:(e=0,t=20)=>d({url:`/prayer/public?skip=${e}&take=${t}`,method:"GET"}),increment:e=>d({url:`/prayer/increment/${e}`,method:"POST"})},devoutPrayer:{create:e=>d({url:"/devout-prayer",method:"POST",data:e}),list:e=>d({url:`/devout-prayer/user/${e}`,method:"GET"}),getDevoutList:()=>d({url:"/devout-prayer/list",method:"GET"}),support:e=>d({url:`/devout-prayer/support/${e}`,method:"POST"}),classify:e=>d({url:"/devout-prayer/classify",method:"POST",data:{content:e}}),getCategories:()=>d({url:"/devout-prayer/categories",method:"GET"}),getDeitiesByCategory:e=>d({url:`/devout-prayer/categories/${e}/deities`,method:"GET"})},reunitePrayer:{create:e=>d({url:"/reunite-prayer",method:"POST",data:e}),list:e=>d({url:`/reunite-prayer/user/${e}`,method:"GET"}),public:(e=0,t=20)=>d({url:`/reunite-prayer/public?skip=${e}&take=${t}`,method:"GET"}),increment:e=>d({url:`/reunite-prayer/increment/${e}`,method:"POST"})},confession:{create:e=>d({url:"/confession",method:"POST",data:e}),list:e=>d({url:`/confession/user/${e}`,method:"GET"}),public:(e=0,t=20)=>d({url:`/confession/public?skip=${e}&take=${t}`,method:"GET"}),match:e=>d({url:`/confession/match/${e}`,method:"POST"})},treehole:{create:e=>d({url:"/treehole",method:"POST",data:e}),list:e=>d({url:`/treehole/user/${e}`,method:"GET"}),public:(e=0,t=20)=>d({url:`/treehole/public?skip=${e}&take=${t}`,method:"GET"}),like:e=>d({url:`/treehole/like/${e}`,method:"POST"}),delete:(e,t)=>d({url:`/treehole/${e}`,method:"DELETE",data:{userId:t}})},dating:{topMatches:()=>d({url:"/dating/top-matches",method:"POST"}),matches:(e,t=10)=>d({url:`/dating/matches/${e}`,method:"POST",data:{limit:t}}),sendMessage:e=>d({url:"/dating/message",method:"POST",data:e}),messages:(e,t)=>d({url:`/dating/messages/${e}/${t}`,method:"GET"}),markRead:e=>d({url:`/dating/message/read/${e}`,method:"POST"}),getUnreadCounts:()=>d({url:"/dating/unread",method:"GET"}),getTotalUnread:()=>d({url:"/dating/unread/total",method:"GET"}),markAllAsRead:e=>d({url:`/dating/read-all/${e}`,method:"POST"}),getContacts:()=>d({url:"/dating/contacts",method:"GET"}),searchUsers:e=>d({url:`/dating/search?keyword=${encodeURIComponent(e)}`,method:"GET"})},palm:{getHistory:()=>d({url:"/palm/history",method:"GET"}),delete:e=>d({url:`/palm/history/${e}`,method:"DELETE"})},user:{get:e=>d({url:`/user/${e}`,method:"GET"}),update:(e,t)=>d({url:`/user/${e}`,method:"PUT",data:t}),delete:e=>d({url:`/user/${e}`,method:"DELETE"})},avatar:{upload:r=>new Promise((d,s)=>{var l;let u="";try{u=a?localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")||"{}").token:"":(null==(l=e("user"))?void 0:l.token)||""}catch(n){}t({url:o+"/avatar/upload",filePath:r,name:"file",header:{Authorization:`Bearer ${u}`},success:e=>{if(200===e.statusCode||201===e.statusCode)try{const t=JSON.parse(e.data);d(t)}catch(n){d(e.data)}else{let t="上传失败";try{const r=JSON.parse(e.data);t=r.message||r.error||t}catch(n){}s(new Error(t))}},fail:e=>{s(new Error(e.errMsg||"上传失败"))}})}),generate:()=>d({url:"/avatar/generate",method:"POST"}),getInfo:()=>d({url:"/avatar/info",method:"GET"})},mbti:{getQuestions:()=>d({url:"/mbti/questions",method:"GET"}),submit:e=>d({url:"/mbti/submit",method:"POST",data:{answers:e}}),getResult:()=>d({url:"/mbti/result",method:"GET"}),getAllTypes:()=>d({url:"/mbti/types",method:"GET"})},dailyFortune:{getToday:()=>d({url:"/daily-fortune/today",method:"GET"}),refresh:()=>d({url:"/daily-fortune/refresh",method:"POST"}),getRecent:()=>d({url:"/daily-fortune/recent",method:"GET"})},famousPeople:{getAllGrouped:()=>d({url:"/famous-people/grouped/all",method:"GET"}),getByZodiac:e=>d({url:`/famous-people/${e}`,method:"GET"})},products:{getList:(e=0,t=20,r)=>{const a=new URLSearchParams({skip:String(e),take:String(t)});return r&&a.append("category",r),d({url:`/products?${a.toString()}`,method:"GET"})},getById:e=>d({url:`/products/${e}`,method:"GET"}),getCategories:()=>d({url:"/products/categories/list",method:"GET"})}},l=(e,t)=>{const r=e.__vccOpts||e;for(const[a,o]of t)r[a]=o;return r};export{l as _,s as a};
