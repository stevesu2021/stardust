import{d as a,r as e,q as t,L as s,v as l,s as n,c as u,b as c,i as r,o,e as i,a as d,f,g as _,I as v,h as m,t as g,F as p,j as h,m as k,y,k as C,u as S}from"./index-VE_HmMG4.js";import{a as D,_ as b}from"./_plugin-vue_export-helper.B_VXoL-J.js";import{u as w}from"./user.DucKNo_G.js";const I=b(a({__name:"matches",setup(a){const b=e([]),I=w(),$=e(""),x=e([]),M=e(!1);let T=null,j=null;function z(a){if(!a)return"";const e=a.content||"";return e.length>20?e.substring(0,20)+"...":e}function A(a){if(!a)return"";const e=new Date(a),t=new Date,s=t.getTime()-e.getTime();if(s<6e4)return"åˆšåˆš";if(s<36e5)return`${Math.floor(s/6e4)}åˆ†é’Ÿå‰`;if(e.toDateString()===t.toDateString()){return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}const l=new Date(t);if(l.setDate(l.getDate()-1),e.toDateString()===l.toDateString())return"æ˜¨å¤©";return`${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}function F(){if(T&&clearTimeout(T),!$.value.trim())return M.value=!1,void(x.value=[]);T=setTimeout(()=>{U()},500)}async function U(){const a=$.value.trim();if(!a)return M.value=!1,void(x.value=[]);M.value=!0;try{const e=await D.dating.searchUsers(a);x.value=e}catch(e){n({title:e.message||"æœç´¢å¤±è´¥",icon:"none"})}}function V(){$.value="",M.value=!1,x.value=[]}async function q(){var a;if(null==(a=I.userInfo)?void 0:a.id)try{const a=await D.dating.getContacts();b.value=a}catch(e){n({title:e.message||"åŠ è½½å¤±è´¥",icon:"none"})}else n({title:"è¯·å…ˆç™»å½•",icon:"none"})}function H(a){S({url:`/pages/dating/chat?otherUserId=${a}`})}return t(()=>{q(),j=setInterval(()=>{M.value||q()},3e4)}),s(()=>{j&&clearInterval(j),T&&clearTimeout(T)}),l(()=>{M.value||q()}),(a,e)=>{const t=f,s=v,l=r,n=k,S=y;return o(),u(l,{class:"container"},{default:c(()=>[i(l,{class:"search-bar"},{default:c(()=>[i(l,{class:"search-input-wrapper"},{default:c(()=>[i(t,{class:"search-icon"},{default:c(()=>[_("ğŸ”")]),_:1}),i(s,{class:"search-input",modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),placeholder:"æœç´¢æ‰‹æœºå·æˆ–æ˜µç§°","confirm-type":"search",onConfirm:U,onInput:F},null,8,["modelValue"]),$.value?(o(),u(t,{key:0,class:"clear-icon",onClick:V},{default:c(()=>[_("âœ•")]),_:1})):d("",!0)]),_:1})]),_:1}),M.value&&x.value.length>0?(o(),u(l,{key:0,class:"contacts search-results"},{default:c(()=>[i(t,{class:"section-title"},{default:c(()=>[_("æœç´¢ç»“æœ ("+g(x.value.length)+")",1)]),_:1}),(o(!0),m(p,null,h(x.value,a=>(o(),u(l,{key:a.id,class:"contact-card",onClick:e=>H(a.id)},{default:c(()=>[i(l,{class:"contact-header"},{default:c(()=>[i(l,{class:"header-left"},{default:c(()=>[i(l,{class:"avatar-wrapper"},{default:c(()=>[a.avatar?(o(),u(n,{key:0,src:a.avatar,class:"avatar",mode:"aspectFill"},null,8,["src"])):(o(),u(t,{key:1,class:"avatar-placeholder"},{default:c(()=>[_(g((a.nickname||"åŒ¿").charAt(0)),1)]),_:2},1024))]),_:2},1024),i(l,{class:"user-info"},{default:c(()=>[i(t,{class:"nickname"},{default:c(()=>[_(g(a.nickname||"åŒ¿å"),1)]),_:2},1024),a.phone?(o(),u(t,{key:0,class:"phone"},{default:c(()=>[_(g(a.phone),1)]),_:2},1024)):d("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(l,{class:"contact-info"},{default:c(()=>[a.zodiacSign?(o(),u(t,{key:0,class:"info-item"},{default:c(()=>[_("æ˜Ÿåº§: "+g(a.zodiacSign),1)]),_:2},1024)):d("",!0),a.gender?(o(),u(t,{key:1,class:"info-item"},{default:c(()=>[_("æ€§åˆ«: "+g("male"===a.gender?"ç”·":"å¥³"),1)]),_:2},1024)):d("",!0)]),_:2},1024),i(S,{class:"chat-btn",onClick:C(e=>H(a.id),["stop"])},{default:c(()=>[i(t,null,{default:c(()=>[_("å‘èµ·èŠå¤©")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128))]),_:1})):d("",!0),M.value&&0===x.value.length?(o(),u(l,{key:1,class:"empty-state"},{default:c(()=>[i(t,{class:"empty-icon"},{default:c(()=>[_("ğŸ”")]),_:1}),i(t,{class:"empty-text"},{default:c(()=>[_("æœªæ‰¾åˆ°ç›¸å…³ç”¨æˆ·")]),_:1})]),_:1})):d("",!0),M.value?d("",!0):(o(),u(l,{key:2,class:"contacts"},{default:c(()=>[b.value.length>0?(o(),u(t,{key:0,class:"section-title"},{default:c(()=>[_("èŠå¤©è”ç³»äºº ("+g(b.value.length)+")",1)]),_:1})):d("",!0),(o(!0),m(p,null,h(b.value,a=>(o(),u(l,{key:a.user.id,class:"contact-card",onClick:e=>H(a.user.id)},{default:c(()=>[i(l,{class:"contact-header"},{default:c(()=>[i(l,{class:"header-left"},{default:c(()=>[i(l,{class:"avatar-wrapper"},{default:c(()=>[a.user.avatar?(o(),u(n,{key:0,src:a.user.avatar,class:"avatar",mode:"aspectFill"},null,8,["src"])):(o(),u(t,{key:1,class:"avatar-placeholder"},{default:c(()=>[_(g((a.user.nickname||"åŒ¿").charAt(0)),1)]),_:2},1024)),a.unreadCount>0?(o(),u(l,{key:2,class:"unread-badge"},{default:c(()=>[i(t,{class:"unread-count"},{default:c(()=>[_(g(a.unreadCount>99?"99+":a.unreadCount),1)]),_:2},1024)]),_:2},1024)):d("",!0)]),_:2},1024),i(l,{class:"user-info"},{default:c(()=>[i(t,{class:"nickname"},{default:c(()=>[_(g(a.user.nickname||"åŒ¿å"),1)]),_:2},1024),i(t,{class:"last-message"},{default:c(()=>[_(g(z(a.lastMessage)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(t,{class:"message-time"},{default:c(()=>{var e;return[_(g(A(null==(e=a.lastMessage)?void 0:e.createdAt)),1)]}),_:2},1024)]),_:2},1024),i(l,{class:"contact-info"},{default:c(()=>[a.user.zodiacSign?(o(),u(t,{key:0,class:"info-item"},{default:c(()=>[_("æ˜Ÿåº§: "+g(a.user.zodiacSign),1)]),_:2},1024)):d("",!0),a.user.gender?(o(),u(t,{key:1,class:"info-item"},{default:c(()=>[_("æ€§åˆ«: "+g("male"===a.user.gender?"ç”·":"å¥³"),1)]),_:2},1024)):d("",!0)]),_:2},1024),i(S,{class:"chat-btn",onClick:C(e=>H(a.user.id),["stop"])},{default:c(()=>[i(t,null,{default:c(()=>[_("èŠå¤©")]),_:1}),a.unreadCount>0?(o(),u(l,{key:0,class:"btn-badge"},{default:c(()=>[i(t,null,{default:c(()=>[_(g(a.unreadCount),1)]),_:2},1024)]),_:2},1024)):d("",!0)]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128)),0===b.value.length?(o(),u(l,{key:1,class:"empty-state"},{default:c(()=>[i(t,{class:"empty-icon"},{default:c(()=>[_("ğŸ’¬")]),_:1}),i(t,{class:"empty-text"},{default:c(()=>[_("è¿˜æ²¡æœ‰èŠå¤©è®°å½•")]),_:1}),i(t,{class:"empty-hint"},{default:c(()=>[_('å»é¦–é¡µ"ç¼˜åˆ†åŒ¹é…"æ‰¾æœ‹å‹èŠå¤©å§')]),_:1})]),_:1})):d("",!0)]),_:1}))]),_:1})}}}),[["__scopeId","data-v-aa72a2d8"]]);export{I as default};
