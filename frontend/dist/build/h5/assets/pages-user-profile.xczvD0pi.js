import{d as e,p as a,c as t,o as l,i as s,b as n,e as c,h as u,j as i,n as o,l as r,F as d,f,g as v,t as m,r as _,q as g,y as p,a as y,m as h,z as k,s as b,u as w,Q as I,R as F,T as C,O as x,U as $,V as U}from"./index-VE_HmMG4.js";import{_ as P,a as j}from"./_plugin-vue_export-helper.B_VXoL-J.js";import{u as A}from"./user.DucKNo_G.js";const D=P(e({__name:"FiveElementsChart",props:{data:{}},setup(e){const _=e,g=[{key:"wood",name:"æœ¨",icon:"ğŸŒ²",color:"#4CAF50",gradient:"linear-gradient(135deg, #4CAF50 0%, #81C784 100%)",description:"ä¸»ä»ï¼Œä»£è¡¨ç”Ÿé•¿ã€å‡å‘ã€æ¡è¾¾èˆ’ç•…"},{key:"fire",name:"ç«",icon:"ğŸ”¥",color:"#F44336",gradient:"linear-gradient(135deg, #F44336 0%, #EF5350 100%)",description:"ä¸»ç¤¼ï¼Œä»£è¡¨æ¸©çƒ­ã€å‡è…¾ã€æ˜äº®"},{key:"earth",name:"åœŸ",icon:"â›°ï¸",color:"#8D6E63",gradient:"linear-gradient(135deg, #8D6E63 0%, #A1887F 100%)",description:"ä¸»ä¿¡ï¼Œä»£è¡¨æ‰¿è½½ã€ç”ŸåŒ–ã€å—çº³"},{key:"metal",name:"é‡‘",icon:"âš”ï¸",color:"#FFC107",gradient:"linear-gradient(135deg, #FFC107 0%, #FFD54F 100%)",description:"ä¸»ä¹‰ï¼Œä»£è¡¨æ²‰é™ã€è‚ƒæ€ã€æ”¶æ•›"},{key:"water",name:"æ°´",icon:"ğŸ’§",color:"#2196F3",gradient:"linear-gradient(135deg, #2196F3 0%, #64B5F6 100%)",description:"ä¸»æ™ºï¼Œä»£è¡¨å¯’å†·ã€æµåŠ¨ã€æ½œè—"}],p=a(()=>g.map(e=>({...e,count:_.data[e.key]||0}))),y=a(()=>[...p.value].sort((e,a)=>a.count-e.count)[0]||{name:"æœªè®¡ç®—",icon:"â“",count:0}),h=a(()=>{const e=Object.values(_.data).reduce((e,a)=>e+a,0);if(0===e)return[];let a=0;return p.value.filter(e=>e.count>0).map(t=>{const l=t.count/e*100,s=a;return a+=t.count/e*360,{element:t.key,percentage:l,rotation:s}})});function k(e){var a;const t=Math.max(e.percentage-2/3.6,0);return{background:null==(a=g.find(a=>a.key===e.element))?void 0:a.gradient,transform:`rotate(${e.rotation}deg)`,clipPath:`polygon(50% 50%, 50% 0%, ${50+.5*t}% 0%, ${50+.5*t}% 100%)`,opacity:t>0?1:0}}function b(e){const a=Math.max(...p.value.map(e=>e.count));return 0===a?"0%":e/a*100+"%"}function w(){if(0===Object.values(_.data).reduce((e,a)=>e+a,0))return"æš‚æ— äº”è¡Œæ•°æ®";const e=p.value.filter(e=>e.count>=2).map(e=>e.name),a=p.value.filter(e=>0===e.count).map(e=>e.name);let t="äº”è¡Œæ„æˆï¼š";return e.length>0&&(t+=` ${e.join("ã€")}æ—º`),a.length>0&&(t+=`ï¼Œç¼º${a.join("ã€")}`),t}return(e,a)=>{const _=s,g=f;return l(),t(_,{class:"five-elements-chart"},{default:n(()=>[c(_,{class:"circle-container"},{default:n(()=>[c(_,{class:"circle-chart"},{default:n(()=>[(l(!0),u(d,null,i(h.value,(e,a)=>(l(),t(_,{key:a,class:r(["segment",e.element]),style:o(k(e))},null,8,["class","style"]))),128)),c(_,{class:"center-circle"},{default:n(()=>[c(_,{class:"dominant-element"},{default:n(()=>[c(g,{class:"element-icon"},{default:n(()=>[v(m(y.value.icon),1)]),_:1}),c(g,{class:"element-name"},{default:n(()=>[v(m(y.value.name),1)]),_:1}),c(g,{class:"element-count"},{default:n(()=>[v(m(y.value.count)+"ä¸ª",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(_,{class:"bars-container"},{default:n(()=>[(l(!0),u(d,null,i(p.value,e=>(l(),t(_,{key:e.key,class:r(["bar-item",e.key])},{default:n(()=>[c(_,{class:"bar-header"},{default:n(()=>[c(g,{class:"bar-icon"},{default:n(()=>[v(m(e.icon),1)]),_:2},1024),c(g,{class:"bar-name"},{default:n(()=>[v(m(e.name),1)]),_:2},1024),c(g,{class:"bar-count"},{default:n(()=>[v(m(e.count),1)]),_:2},1024)]),_:2},1024),c(_,{class:"bar-track"},{default:n(()=>[c(_,{class:"bar-fill",style:o({width:b(e.count)})},null,8,["style"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}),c(_,{class:"description"},{default:n(()=>[c(g,{class:"desc-text"},{default:n(()=>[v(m(w()),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-7df2b8ff"]]),E=P(e({__name:"profile",setup(e){const u=A(),i=_(null),o=_(!1),r=a(()=>{var e;if(!(null==(e=i.value)?void 0:e.fiveElements))return null;try{return JSON.parse(i.value.fiveElements)}catch{return null}}),d=a(()=>!!u.token&&!!u.userInfo);async function P(){o.value=!0;try{const e=await new Promise((e,a)=>{k({provider:"weixin",success:e,fail:a})}),a=await new Promise((e,a)=>{uni.getUserProfile({desc:"ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™",success:e,fail:a})}),t=await j.auth.wechatLogin({code:e.code,userInfo:a.userInfo});u.setToken(t.token),u.setUserInfo(t.user),i.value=t.user,t.isNewUser?(b({title:"æ¬¢è¿æ–°ç”¨æˆ·ï¼",icon:"success"}),setTimeout(()=>{w({url:"/pages/user/edit-profile"})},1500)):b({title:"ç™»å½•æˆåŠŸ",icon:"success"})}catch(e){e.errMsg&&e.errMsg.includes("getUserProfile:fail")?b({title:"éœ€è¦æˆæƒæ‰èƒ½ä½¿ç”¨å¾®ä¿¡ç™»å½•",icon:"none"}):b({title:e.message||"å¾®ä¿¡ç™»å½•å¤±è´¥",icon:"none"})}finally{o.value=!1}}async function E(){try{const e=await new Promise((e,a)=>{k({provider:"weixin",success:e,fail:a})});await j.auth.bindWechat({code:e.code});const a=await j.auth.getProfile();u.setUserInfo(a.user),i.value=a.user,b({title:"å¾®ä¿¡ç»‘å®šæˆåŠŸ",icon:"success"})}catch(e){b({title:e.message||"ç»‘å®šå¤±è´¥",icon:"none"})}}async function O(){I({title:"æç¤º",content:"ç¡®å®šè¦è§£ç»‘å¾®ä¿¡è´¦å·å—ï¼Ÿè§£ç»‘åéœ€è¦ç»‘å®šå…¶ä»–ç™»å½•æ–¹å¼",success:async e=>{if(e.confirm)try{const e=await j.auth.unbindWechat();u.setUserInfo(e.user),i.value=e.user,b({title:"è§£ç»‘æˆåŠŸ",icon:"success"})}catch(a){b({title:a.message||"è§£ç»‘å¤±è´¥",icon:"none"})}}})}async function T(){var e;if(null==(e=i.value)?void 0:e.id)try{await j.astrology.calculate(i.value.id);const e=await j.auth.getProfile();i.value=e.user,u.setUserInfo(e.user),b({title:"è®¡ç®—æˆåŠŸ",icon:"success"})}catch(a){b({title:a.message||"è®¡ç®—å¤±è´¥",icon:"none"})}else b({title:"è¯·å…ˆç™»å½•",icon:"none"})}function M(){I({title:"æç¤º",content:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",success:e=>{e.confirm&&(u.logout(),b({title:"å·²é€€å‡ºç™»å½•",icon:"success"}),setTimeout(()=>{F({url:"/pages/user/profile"})},1e3))}})}function z(){w({url:"/pages/auth/login"})}function q(){w({url:"/pages/auth/register"})}function L(){w({url:"/pages/user/edit-profile"})}function N(){var e;const a=["ä»ç›¸å†Œé€‰æ‹©","AI ç”Ÿæˆå¤´åƒ"];(null==(e=i.value)?void 0:e.avatar)&&a.push("åˆ é™¤å¤´åƒ"),C({itemList:a,success:e=>{0===e.tapIndex?x({count:1,sizeType:["compressed"],sourceType:["album"],success:e=>{!async function(e){$({title:"ä¸Šä¼ ä¸­..."});try{const a=await j.avatar.upload(e),t=a.avatar.includes("?")?`${a.avatar}&t=${Date.now()}`:`${a.avatar}?t=${Date.now()}`,l={...i.value,avatar:t};i.value=l,u.setUserInfo(l),b({title:"ä¸Šä¼ æˆåŠŸ",icon:"success"})}catch(a){b({title:a.message||"ä¸Šä¼ å¤±è´¥",icon:"none"})}finally{U()}}(e.tempFilePaths[0])}}):1===e.tapIndex?async function(){I({title:"AI ç”Ÿæˆå¤´åƒ",content:"AI å°†æ ¹æ®æ‚¨çš„ç”Ÿæ—¥ã€æ˜Ÿåº§ç­‰ä¿¡æ¯ä¸ºæ‚¨ç”Ÿæˆä¸“å±å¤´åƒï¼Œç”Ÿæˆè¿‡ç¨‹å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ",success:e=>{e.confirm&&async function(){$({title:"AI ç”Ÿæˆä¸­...",mask:!0});try{const e=await j.avatar.generate(),a=e.avatar.includes("?")?`${e.avatar}&t=${Date.now()}`:`${e.avatar}?t=${Date.now()}`,t={...i.value,avatar:a};i.value=t,u.setUserInfo(t),b({title:"ç”ŸæˆæˆåŠŸ",icon:"success"})}catch(e){b({title:e.message||"ç”Ÿæˆå¤±è´¥ï¼Œå¯ä»¥é‡è¯•",icon:"none"})}finally{U()}}()}})}():2===e.tapIndex&&I({title:"æç¤º",content:"ç¡®å®šè¦åˆ é™¤å¤´åƒå—ï¼Ÿ",success:async e=>{if(e.confirm)try{await j.user.update(i.value.id,{avatar:null}),i.value.avatar=null,u.setUserInfo(i.value),b({title:"åˆ é™¤æˆåŠŸ",icon:"success"})}catch(a){b({title:a.message||"åˆ é™¤å¤±è´¥",icon:"none"})}}})}})}return g(()=>{d.value&&(i.value=u.userInfo)}),(e,a)=>{const u=s,o=f,_=p,g=h;return l(),t(u,{class:"container"},{default:n(()=>[d.value?(l(),t(u,{key:1,class:"logged-in"},{default:n(()=>[c(u,{class:"profile"},{default:n(()=>{var e,a;return[c(u,{class:"avatar",onClick:N},{default:n(()=>{var e;return[(null==(e=i.value)?void 0:e.avatar)?(l(),t(g,{key:0,src:i.value.avatar,class:"avatar-image",mode:"aspectFill"},null,8,["src"])):(l(),t(o,{key:1,class:"avatar-text"},{default:n(()=>{var e,a;return[v(m((null==(a=null==(e=i.value)?void 0:e.nickname)?void 0:a.charAt(0))||"U"),1)]}),_:1})),c(u,{class:"avatar-edit-icon"},{default:n(()=>[v("ğŸ“·")]),_:1})]}),_:1}),c(o,{class:"nickname"},{default:n(()=>{var e;return[v(m((null==(e=i.value)?void 0:e.nickname)||"æœªè®¾ç½®"),1)]}),_:1}),(null==(e=i.value)?void 0:e.phone)?(l(),t(o,{key:0,class:"phone-number"},{default:n(()=>[v(m(i.value.phone),1)]),_:1})):y("",!0),(null==(a=i.value)?void 0:a.wechatOpenId)?(l(),t(o,{key:1,class:"user-id"},{default:n(()=>[v("ğŸ’¬ å·²ç»‘å®šå¾®ä¿¡")]),_:1})):y("",!0)]}),_:1}),i.value?(l(),t(u,{key:0,class:"info"},{default:n(()=>[c(u,{class:"info-item"},{default:n(()=>[c(o,{class:"label"},{default:n(()=>[v("å†œå†ç”Ÿæ—¥")]),_:1}),c(o,{class:"value"},{default:n(()=>[v(m(i.value.lunarDate||"æœªè®¡ç®—"),1)]),_:1})]),_:1}),c(u,{class:"info-item"},{default:n(()=>[c(o,{class:"label"},{default:n(()=>[v("æ˜Ÿåº§")]),_:1}),c(o,{class:"value"},{default:n(()=>[v(m(i.value.zodiacSign||"æœªè®¡ç®—"),1)]),_:1})]),_:1}),c(u,{class:"info-item full-width"},{default:n(()=>[c(o,{class:"label"},{default:n(()=>[v("äº”è¡Œå‘½ç†")]),_:1}),r.value?(l(),t(D,{key:0,data:r.value},null,8,["data"])):(l(),t(o,{key:1,class:"value"},{default:n(()=>[v("æœªè®¡ç®—")]),_:1}))]),_:1}),c(u,{class:"info-item"},{default:n(()=>[c(o,{class:"label"},{default:n(()=>[v("æ€§åˆ«")]),_:1}),c(o,{class:"value"},{default:n(()=>[v(m("male"===i.value.gender?"ç”·":"female"===i.value.gender?"å¥³":"æœªè®¾ç½®"),1)]),_:1})]),_:1}),c(u,{class:"info-item"},{default:n(()=>[c(o,{class:"label"},{default:n(()=>[v("ä¸ªäººç®€ä»‹")]),_:1}),c(o,{class:"value"},{default:n(()=>[v(m(i.value.bio||"æœªè®¾ç½®"),1)]),_:1})]),_:1})]),_:1})):y("",!0),c(u,{class:"actions"},{default:n(()=>{var e;return[c(_,{class:"btn",onClick:T},{default:n(()=>[v("è®¡ç®—æ˜Ÿç›˜")]),_:1}),c(_,{class:"btn btn-secondary",onClick:L},{default:n(()=>[v("ç¼–è¾‘èµ„æ–™")]),_:1}),(null==(e=i.value)?void 0:e.wechatOpenId)?(l(),t(_,{key:1,class:"btn btn-wechat-unbind",onClick:O},{default:n(()=>[v(" è§£ç»‘å¾®ä¿¡è´¦å· ")]),_:1})):(l(),t(_,{key:0,class:"btn btn-wechat",onClick:E},{default:n(()=>[v(" ç»‘å®šå¾®ä¿¡è´¦å· ")]),_:1})),c(_,{class:"btn btn-logout",onClick:M},{default:n(()=>[v("é€€å‡ºç™»å½•")]),_:1})]}),_:1})]),_:1})):(l(),t(u,{key:0,class:"login-required"},{default:n(()=>[c(u,{class:"login-icon"},{default:n(()=>[v("ğŸ‘‹")]),_:1}),c(o,{class:"title"},{default:n(()=>[v("æ¬¢è¿æ¥åˆ°æ˜Ÿå¥‘é›†")]),_:1}),c(o,{class:"subtitle"},{default:n(()=>[v("ç™»å½•åäº«å—æ›´å¤šä¸ªæ€§åŒ–æœåŠ¡")]),_:1}),c(u,{class:"login-options"},{default:n(()=>[c(u,{class:"wechat-login-btn",onClick:P},{default:n(()=>[c(o,{class:"wechat-icon"},{default:n(()=>[v("ğŸ’¬")]),_:1}),c(o,null,{default:n(()=>[v("å¾®ä¿¡ä¸€é”®ç™»å½•")]),_:1})]),_:1}),c(u,{class:"divider"},{default:n(()=>[c(u,{class:"line"}),c(o,{class:"divider-text"},{default:n(()=>[v("æˆ–")]),_:1}),c(u,{class:"line"})]),_:1}),c(_,{class:"btn",onClick:z},{default:n(()=>[v("è´¦å·å¯†ç ç™»å½•")]),_:1}),c(u,{class:"register-link"},{default:n(()=>[c(o,{class:"link-text",onClick:q},{default:n(()=>[v("è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†Œ")]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-45e5a43b"]]);export{E as default};
