import{d as a,r as e,c as l,b as t,i as s,o as c,e as u,a as i,l as d,f as n,g as r,m as o,y as f,t as _,h as v,F as p,j as y,k as m,O as h,s as g,u as k,P as w,Q as b}from"./index-VE_HmMG4.js";import{u as C}from"./user.DucKNo_G.js";import{a as S,_ as z}from"./_plugin-vue_export-helper.B_VXoL-J.js";const L=z(a({__name:"reading",setup(a){const z=C(),L=e("analyze"),$=e(""),x=e(!1),F=e(null),j=e([]),A=e(!1),O=e(!1),P=e(null);function T(){h({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:a=>{$.value=a.tempFilePaths[0],F.value=null},fail:()=>{g({title:"é€‰æ‹©å›¾ç‰‡å¤±è´¥",icon:"none"})}})}async function I(){if(!$.value)return void g({title:"è¯·å…ˆä¸Šä¼ æ‰‹ç›¸ç…§ç‰‡",icon:"none"});let a=z.token||"";if(!a)try{const e=localStorage.getItem("user");if(e){const l=JSON.parse(e);a=l.token||""}}catch(e){console.error("èŽ·å– token å¤±è´¥:",e)}if(!a)return g({title:"è¯·å…ˆç™»å½•",icon:"none"}),void setTimeout(()=>{k({url:"/pages/auth/login"})},1500);x.value=!0;try{const e=await new Promise((e,l)=>{w({url:"/api/palm/analyze",filePath:$.value,name:"image",header:{Authorization:`Bearer ${a}`},success:e,fail:l})});if(200===e.statusCode||201===e.statusCode)F.value=JSON.parse(e.data),g({title:"åˆ†æžå®Œæˆ",icon:"success"});else if(401===e.statusCode)g({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout(()=>{k({url:"/pages/auth/login"})},1500);else try{const a=JSON.parse(e.data);throw new Error(a.message||a.error||"åˆ†æžå¤±è´¥")}catch{throw new Error(`åˆ†æžå¤±è´¥ (${e.statusCode})`)}}catch(l){console.error("æ‰‹ç›¸åˆ†æžé”™è¯¯:",l),g({title:l.message||"åˆ†æžå¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:3e3})}finally{x.value=!1}}function J(){$.value="",F.value=null}async function N(){L.value="history",await async function(){A.value=!0;try{const a=await S.palm.getHistory();j.value=a}catch(a){console.error("åŠ è½½åŽ†å²å¤±è´¥:",a),g({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{A.value=!1}}()}function D(a){if(!a)return"";const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}return(a,e)=>{const h=n,k=s,w=o,C=f;return c(),l(k,{class:"container"},{default:t(()=>[u(k,{class:"tabs"},{default:t(()=>[u(k,{class:d(["tab",{active:"analyze"===L.value}]),onClick:e[0]||(e[0]=a=>L.value="analyze")},{default:t(()=>[u(h,null,{default:t(()=>[r("çœ‹æ‰‹ç›¸")]),_:1})]),_:1},8,["class"]),u(k,{class:d(["tab",{active:"history"===L.value}]),onClick:N},{default:t(()=>[u(h,null,{default:t(()=>[r("åŽ†å²è®°å½•")]),_:1})]),_:1},8,["class"])]),_:1}),"analyze"===L.value?(c(),l(k,{key:0,class:"analyze-view"},{default:t(()=>[u(k,{class:"upload-section"},{default:t(()=>[u(k,{class:"upload-box",onClick:T},{default:t(()=>[$.value?(c(),l(w,{key:0,src:$.value,class:"preview-image",mode:"aspectFit"},null,8,["src"])):(c(),l(k,{key:1,class:"upload-placeholder"},{default:t(()=>[u(h,{class:"upload-icon"},{default:t(()=>[r("ðŸ“·")]),_:1}),u(h,{class:"upload-text"},{default:t(()=>[r("ç‚¹å‡»ä¸Šä¼ æ‰‹ç›¸ç…§ç‰‡")]),_:1}),u(h,{class:"upload-hint"},{default:t(()=>[r("è¯·æ¸…æ™°æ‹æ‘„æ‰‹æŽŒçº¹è·¯")]),_:1})]),_:1}))]),_:1}),u(k,{class:"tips"},{default:t(()=>[u(h,{class:"tips-title"},{default:t(()=>[r("æ‹æ‘„å»ºè®®ï¼š")]),_:1}),u(h,{class:"tips-item"},{default:t(()=>[r("â€¢ ä¿æŒæ‰‹æŽŒå¹³æ•´ï¼Œå…‰çº¿å……è¶³")]),_:1}),u(h,{class:"tips-item"},{default:t(()=>[r("â€¢ çº¹è·¯æ¸…æ™°å¯è§")]),_:1}),u(h,{class:"tips-item"},{default:t(()=>[r("â€¢ å»ºè®®æ‹æ‘„å·¦æ‰‹ï¼ˆç”·å·¦å¥³å³ï¼‰")]),_:1})]),_:1})]),_:1}),u(C,{class:"btn-analyze",onClick:I,loading:x.value,disabled:!$.value},{default:t(()=>[r(_(x.value?"åˆ†æžä¸­...":"å¼€å§‹åˆ†æž"),1)]),_:1},8,["loading","disabled"]),F.value?(c(),l(k,{key:0,class:"result-section"},{default:t(()=>[u(k,{class:"result-header"},{default:t(()=>[u(h,{class:"result-title"},{default:t(()=>[r("ðŸ”® æ‰‹ç›¸åˆ†æžç»“æžœ")]),_:1}),u(h,{class:"result-subtitle"},{default:t(()=>[r("åŸºäºŽAIè§†è§‰å¤§æ¨¡åž‹åˆ†æž")]),_:1})]),_:1}),u(k,{class:"result-content"},{default:t(()=>[u(k,{class:"result-card life-line"},{default:t(()=>[u(k,{class:"card-header"},{default:t(()=>[u(k,{class:"icon-wrapper"},{default:t(()=>[u(h,{class:"card-icon"},{default:t(()=>[r("ðŸ’š")]),_:1})]),_:1}),u(h,{class:"card-title"},{default:t(()=>[r("ç”Ÿå‘½çº¿")]),_:1})]),_:1}),u(h,{class:"card-content"},{default:t(()=>[r(_(F.value.lifeLine||"æš‚æ— åˆ†æž"),1)]),_:1})]),_:1}),u(k,{class:"result-card wisdom-line"},{default:t(()=>[u(k,{class:"card-header"},{default:t(()=>[u(k,{class:"icon-wrapper"},{default:t(()=>[u(h,{class:"card-icon"},{default:t(()=>[r("ðŸ’¡")]),_:1})]),_:1}),u(h,{class:"card-title"},{default:t(()=>[r("æ™ºæ…§çº¿")]),_:1})]),_:1}),u(h,{class:"card-content"},{default:t(()=>[r(_(F.value.wisdomLine||"æš‚æ— åˆ†æž"),1)]),_:1})]),_:1}),u(k,{class:"result-card love-line"},{default:t(()=>[u(k,{class:"card-header"},{default:t(()=>[u(k,{class:"icon-wrapper"},{default:t(()=>[u(h,{class:"card-icon"},{default:t(()=>[r("â¤ï¸")]),_:1})]),_:1}),u(h,{class:"card-title"},{default:t(()=>[r("æ„Ÿæƒ…çº¿")]),_:1})]),_:1}),u(h,{class:"card-content"},{default:t(()=>[r(_(F.value.loveLine||"æš‚æ— åˆ†æž"),1)]),_:1})]),_:1}),u(k,{class:"result-card career-line"},{default:t(()=>[u(k,{class:"card-header"},{default:t(()=>[u(k,{class:"icon-wrapper"},{default:t(()=>[u(h,{class:"card-icon"},{default:t(()=>[r("ðŸš€")]),_:1})]),_:1}),u(h,{class:"card-title"},{default:t(()=>[r("äº‹ä¸šçº¿")]),_:1})]),_:1}),u(h,{class:"card-content"},{default:t(()=>[r(_(F.value.careerLine||"æš‚æ— åˆ†æž"),1)]),_:1})]),_:1}),u(k,{class:"result-card overall"},{default:t(()=>[u(k,{class:"card-header"},{default:t(()=>[u(k,{class:"icon-wrapper"},{default:t(()=>[u(h,{class:"card-icon"},{default:t(()=>[r("â­")]),_:1})]),_:1}),u(h,{class:"card-title"},{default:t(()=>[r("ç»¼åˆè¿åŠ¿")]),_:1})]),_:1}),u(h,{class:"card-content"},{default:t(()=>[r(_(F.value.overall||"æš‚æ— åˆ†æž"),1)]),_:1})]),_:1})]),_:1}),u(k,{class:"action-buttons"},{default:t(()=>[u(C,{class:"btn-reanalyze",onClick:J},{default:t(()=>[u(h,null,{default:t(()=>[r("é‡æ–°æ‹æ‘„åˆ†æž")]),_:1})]),_:1})]),_:1})]),_:1})):i("",!0)]),_:1})):i("",!0),"history"===L.value?(c(),l(k,{key:1,class:"history-view"},{default:t(()=>[0!==j.value.length||A.value?A.value?(c(),l(k,{key:1,class:"loading-state"},{default:t(()=>[u(h,null,{default:t(()=>[r("åŠ è½½ä¸­...")]),_:1})]),_:1})):(c(),l(k,{key:2,class:"history-list"},{default:t(()=>[(c(!0),v(p,null,y(j.value,a=>(c(),l(k,{key:a.id,class:"history-item",onClick:e=>function(a){P.value=a,O.value=!0}(a)},{default:t(()=>[u(w,{src:a.imageUrl,class:"history-image",mode:"aspectFill"},null,8,["src"]),u(k,{class:"history-info"},{default:t(()=>[u(h,{class:"history-date"},{default:t(()=>[r(_(D(a.createdAt)),1)]),_:2},1024),u(h,{class:"history-preview"},{default:t(()=>{var e;return[r(_((null==(e=a.overall)?void 0:e.substring(0,30))||"ç»¼åˆè¿åŠ¿åˆ†æž")+"...",1)]}),_:2},1024)]),_:2},1024),u(k,{class:"history-actions",onClick:e[1]||(e[1]=m(()=>{},["stop"]))},{default:t(()=>[u(h,{class:"btn-delete",onClick:e=>async function(a){b({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡æ‰‹ç›¸è®°å½•å—ï¼Ÿ",success:async e=>{if(e.confirm)try{await S.palm.delete(a),j.value=j.value.filter(e=>e.id!==a),g({title:"åˆ é™¤æˆåŠŸ",icon:"success"})}catch(l){console.error("åˆ é™¤å¤±è´¥:",l),g({title:l.message||"åˆ é™¤å¤±è´¥",icon:"none"})}}})}(a.id)},{default:t(()=>[r("åˆ é™¤")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(c(),l(k,{key:0,class:"empty-state"},{default:t(()=>[u(h,{class:"empty-icon"},{default:t(()=>[r("ðŸ“œ")]),_:1}),u(h,{class:"empty-text"},{default:t(()=>[r("æš‚æ— åŽ†å²è®°å½•")]),_:1}),u(h,{class:"empty-hint"},{default:t(()=>[r("æ‹æ‘„æ‰‹ç›¸åŽï¼Œè®°å½•ä¼šè‡ªåŠ¨ä¿å­˜åœ¨è¿™é‡Œ")]),_:1})]),_:1}))]),_:1})):i("",!0),O.value?(c(),l(k,{key:2,class:"detail-modal",onClick:e[4]||(e[4]=a=>O.value=!1)},{default:t(()=>[u(k,{class:"detail-content",onClick:e[3]||(e[3]=m(()=>{},["stop"]))},{default:t(()=>[u(k,{class:"detail-header"},{default:t(()=>[u(h,{class:"detail-title"},{default:t(()=>[r("æ‰‹ç›¸åˆ†æžè¯¦æƒ…")]),_:1}),u(h,{class:"detail-close",onClick:e[2]||(e[2]=a=>O.value=!1)},{default:t(()=>[r("âœ•")]),_:1})]),_:1}),u(k,{class:"detail-image-wrapper"},{default:t(()=>{var a;return[u(w,{src:null==(a=P.value)?void 0:a.imageUrl,class:"detail-image",mode:"aspectFit"},null,8,["src"])]}),_:1}),u(k,{class:"detail-body"},{default:t(()=>[u(k,{class:"detail-section"},{default:t(()=>[u(h,{class:"detail-label"},{default:t(()=>[r("ç”Ÿå‘½çº¿")]),_:1}),u(h,{class:"detail-value"},{default:t(()=>{var a;return[r(_((null==(a=P.value)?void 0:a.lifeLine)||"æš‚æ— åˆ†æž"),1)]}),_:1})]),_:1}),u(k,{class:"detail-section"},{default:t(()=>[u(h,{class:"detail-label"},{default:t(()=>[r("æ™ºæ…§çº¿")]),_:1}),u(h,{class:"detail-value"},{default:t(()=>{var a;return[r(_((null==(a=P.value)?void 0:a.wisdomLine)||"æš‚æ— åˆ†æž"),1)]}),_:1})]),_:1}),u(k,{class:"detail-section"},{default:t(()=>[u(h,{class:"detail-label"},{default:t(()=>[r("æ„Ÿæƒ…çº¿")]),_:1}),u(h,{class:"detail-value"},{default:t(()=>{var a;return[r(_((null==(a=P.value)?void 0:a.loveLine)||"æš‚æ— åˆ†æž"),1)]}),_:1})]),_:1}),u(k,{class:"detail-section"},{default:t(()=>[u(h,{class:"detail-label"},{default:t(()=>[r("äº‹ä¸šçº¿")]),_:1}),u(h,{class:"detail-value"},{default:t(()=>{var a;return[r(_((null==(a=P.value)?void 0:a.careerLine)||"æš‚æ— åˆ†æž"),1)]}),_:1})]),_:1}),u(k,{class:"detail-section"},{default:t(()=>[u(h,{class:"detail-label"},{default:t(()=>[r("ç»¼åˆè¿åŠ¿")]),_:1}),u(h,{class:"detail-value"},{default:t(()=>{var a;return[r(_((null==(a=P.value)?void 0:a.overall)||"æš‚æ— åˆ†æž"),1)]}),_:1})]),_:1})]),_:1}),u(k,{class:"detail-footer"},{default:t(()=>[u(h,{class:"detail-time"},{default:t(()=>{var a;return[r(_(D(null==(a=P.value)?void 0:a.createdAt)),1)]}),_:1})]),_:1})]),_:1})]),_:1})):i("",!0)]),_:1})}}}),[["__scopeId","data-v-c830358e"]]);export{L as default};
