# æ˜Ÿå°˜ - éƒ¨ç½²ä¸å‘å¸ƒè®¡åˆ’

## ğŸ“‹ éƒ¨ç½²æ¶æ„æ€»è§ˆ

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ç«¯ (å¤šç«¯)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  H5ç½‘ç«™ â”‚  â”‚å¾®ä¿¡å°ç¨‹åºâ”‚  â”‚æŠ–éŸ³å°ç¨‹åºâ”‚  â”‚ Appç«¯   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚            â”‚             â”‚             â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CDN / è´Ÿè½½å‡è¡¡å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nginx (åå‘ä»£ç†)                                â”‚   â”‚
â”‚  â”‚  - é™æ€èµ„æºç¼“å­˜                                  â”‚   â”‚
â”‚  â”‚  - API è·¯ç”±åˆ†å‘                                  â”‚   â”‚
â”‚  â”‚  - SSL ç»ˆç«¯                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åº”ç”¨æœåŠ¡å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nest.js API æœåŠ¡ (å¤šå®ä¾‹)                       â”‚   â”‚
â”‚  â”‚  - è®¤è¯æœåŠ¡                                      â”‚   â”‚
â”‚  â”‚  - ä¸šåŠ¡é€»è¾‘                                      â”‚   â”‚
â”‚  â”‚  - WebSocket (å®æ—¶èŠå¤©)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚  å¯¹è±¡å­˜å‚¨ OSS    â”‚      â”‚
â”‚  â”‚ (ä¸»ä»)   â”‚  â”‚ (ç¼“å­˜)   â”‚  â”‚ (å›¾ç‰‡/æ–‡ä»¶)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ ç¯å¢ƒé…ç½®

### ä¸€ã€å¼€å‘ç¯å¢ƒ

#### 1.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ
```bash
# å‰ç«¯å¼€å‘
cd frontend
npm install
npm run dev:h5          # H5 å¼€å‘
npm run dev:mp-weixin   # å¾®ä¿¡å°ç¨‹åºå¼€å‘
npm run dev:mp-toutiao  # æŠ–éŸ³å°ç¨‹åºå¼€å‘
npm run dev:app         # App å¼€å‘

# åç«¯å¼€å‘
cd backend
npm install
npm run start:dev       # å¼€å‘æ¨¡å¼å¯åŠ¨

# æ•°æ®åº“
docker-compose up -d db redis
cd backend
npx prisma migrate dev
npx prisma db seed
```

#### 1.2 å¼€å‘ç¯å¢ƒé…ç½®
```env
# backend/.env.development
PORT=3000
DATABASE_URL="postgresql://user:pass@localhost:5432/stardust_dev"
REDIS_URL="redis://localhost:6379"
JWT_SECRET="dev-secret-key"
JWT_EXPIRES_IN="7d"

# å‰ç«¯ä»£ç†é…ç½® (vite.config.ts)
proxy: {
  '/api': {
    target: 'http://localhost:3000',
    changeOrigin: true
  }
}
```

### äºŒã€æµ‹è¯•ç¯å¢ƒ

#### 2.1 æµ‹è¯•ç¯å¢ƒé…ç½®
```yaml
# docker-compose.test.yml
version: '3.8'

services:
  backend:
    build: ./backend
    environment:
      - NODE_ENV=test
      - DATABASE_URL=postgresql://test:pass@test-db:5432/stardust_test
      - REDIS_URL=redis://test-redis:6379
      - JWT_SECRET=test-secret-key
    ports:
      - "3001:3000"
    depends_on:
      - test-db
      - test-redis

  test-db:
    image: postgres:15
    environment:
      POSTGRES_DB: stardust_test
      POSTGRES_USER: test
      POSTGRES_PASSWORD: pass
    ports:
      - "5433:5432"

  test-redis:
    image: redis:7-alpine
    ports:
      - "6380:6379"

  frontend:
    build: ./frontend
    ports:
      - "8081:80"
    environment:
      - API_BASE_URL=http://backend:3000
```

#### 2.2 è‡ªåŠ¨åŒ–æµ‹è¯•
```bash
# åç«¯æµ‹è¯•
cd backend
npm run test          # å•å…ƒæµ‹è¯•
npm run test:e2e      # E2Eæµ‹è¯•
npm run test:cov      # ä»£ç è¦†ç›–ç‡

# å‰ç«¯æµ‹è¯• (å¾…é…ç½®)
cd frontend
npm run test:unit
npm run test:e2e
```

### ä¸‰ã€ç”Ÿäº§ç¯å¢ƒ

#### 3.1 ç”Ÿäº§ç¯å¢ƒé…ç½®
```env
# backend/.env.production
PORT=3000
DATABASE_URL="postgresql://user:pass@prod-db:5432/stardust"
REDIS_URL="redis://prod-redis:6379"
JWT_SECRET="prod-secret-key-from-vault"
JWT_EXPIRES_IN="7d"

# CDN é…ç½®
CDN_URL="https://cdn.stardust.app"
OSS_ACCESS_KEY="your-oss-key"
OSS_SECRET="your-oss-secret"

# ç›‘æ§é…ç½®
SENTRY_DSN="https://xxx.ingest.sentry.io/xxx"
```

#### 3.2 ç”Ÿäº§ç¯å¢ƒå®‰å…¨
```bash
# ç”Ÿæˆå¼ºå¯†ç 
openssl rand -base64 32

# å¯†é’¥ç®¡ç† (ä½¿ç”¨ Vault æˆ–äº‘æœåŠ¡å•† KMS)
# AWS Secrets Manager / é˜¿é‡Œäº‘ KMS / è…¾è®¯äº‘ Secrets Manager
```

---

## ğŸ³ Docker éƒ¨ç½²

### ä¸€ã€å‰ç«¯ Docker åŒ–

#### 1.1 H5 Dockerfile
```dockerfile
# frontend/Dockerfile.h5

# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶ä¾èµ–
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶æºç 
COPY . .

# æ„å»º H5
RUN npm run build:h5

# è¿è¡Œé˜¶æ®µ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist/h5 /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/nginx.conf

# è®¾ç½®æ—¶åŒº
RUN apk add --no-cache tzdata \
    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    && echo "Asia/Shanghai" > /etc/timezone

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 1.2 Nginx é…ç½®
```nginx
# frontend/nginx.conf

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        application/json
        application/javascript
        text/xml
        application/xml
        application/xml+rss
        text/javascript;

    # ç¼“å­˜ç­–ç•¥
    map $uri $cache_control {
        ~*\.(js|css)$ "public, max-age=31536000, immutable";
        ~*\.(png|jpg|jpeg|gif|ico|svg)$ "public, max-age=31536000, immutable";
        default "no-cache";
    }

    server {
        listen 80;
        server_name stardust.app www.stardust.app;

        # å®‰å…¨å¤´
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;

        # SPA è·¯ç”±æ”¯æŒ
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
            add_header Cache-Control $cache_control;
        }

        # API ä»£ç†
        location /api/ {
            proxy_pass http://backend:3000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # WebSocket æ”¯æŒ
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }

        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
```

#### 1.3 å°ç¨‹åºæ„å»º
```bash
# å¾®ä¿¡å°ç¨‹åº
npm run build:mp-weixin
# ç”Ÿæˆç›®å½•: dist/build/mp-weixin

# æŠ–éŸ³å°ç¨‹åº
npm run build:mp-toutiao
# ç”Ÿæˆç›®å½•: dist/build/mp-toutiao

# ä¸Šä¼ è‡³å„å¹³å°åå°
```

### äºŒã€åç«¯ Docker åŒ–

#### 2.1 åç«¯ Dockerfile
```dockerfile
# backend/Dockerfile

# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶ package.json
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ– (åŒ…æ‹¬ devDependencies)
RUN npm ci

# å¤åˆ¶æºç 
COPY . .

# æ„å»º
RUN npm run build

# è¿è¡Œé˜¶æ®µ
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ package.json
COPY package*.json ./

# åªå®‰è£…ç”Ÿäº§ä¾èµ–
RUN npm ci --only=production && npm cache clean --force

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist ./dist

# å¤åˆ¶ Prisma å®¢æˆ·ç«¯
COPY --from=builder /app/node_modules/.prisma ./node_modules/.prisma

# è®¾ç½®æ—¶åŒº
RUN apk add --no-cache tzdata \
    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    && echo "Asia/Shanghai" > /etc/timezone

# åˆ›å»ºé root ç”¨æˆ·
RUN addgroup -g 1001 -S nodejs \
    && adduser -S nestjs -u 1001

# æ›´æ”¹ç›®å½•æƒé™
RUN chown -R nestjs:nodejs /app

USER nestjs

EXPOSE 3000

CMD ["node", "dist/main"]
```

#### 2.2 Docker Compose ç”Ÿäº§é…ç½®
```yaml
# docker-compose.prod.yml

version: '3.8'

services:
  # Nginx åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
      - frontend-dist:/usr/share/nginx/html
    depends_on:
      - backend
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # åç«¯ API (å¤šå®ä¾‹)
  backend:
    build: ./backend
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:${DB_PASSWORD}@db:5432/stardust
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    depends_on:
      - db
      - redis
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # PostgreSQL ä¸»åº“
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: stardust
      POSTGRES_USER: user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user"]
      interval: 10s
      timeout: 5s
      retries: 5

  # PostgreSQL ä»åº“ (è¯»å†™åˆ†ç¦»)
  db-replica:
    image: postgres:15
    environment:
      POSTGRES_DB: stardust
      POSTGRES_USER: user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_replica_data:/var/lib/postgresql/data
    depends_on:
      - db
    restart: unless-stopped

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5

  # ç›‘æ§ (å¯é€‰)
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    restart: unless-stopped

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
    restart: unless-stopped

volumes:
  postgres_data:
  postgres_replica_data:
  redis_data:
  grafana_data:
  frontend-dist:
```

### ä¸‰ã€CI/CD æµç¨‹

#### 3.1 GitHub Actions é…ç½®
```yaml
# .github/workflows/deploy.yml

name: Deploy to Production

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test
        ports:
          - 5432:5432
        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5

      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: --health-cmd "redis-cli ping" --health-interval 10s --health-timeout 5s --health-retries 5

    steps:
      - uses: actions/checkout@v3

      # åç«¯æµ‹è¯•
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json

      - name: Install Backend Dependencies
        working-directory: ./backend
        run: npm ci

      - name: Run Backend Tests
        working-directory: ./backend
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test
          REDIS_URL: redis://localhost:6379
          JWT_SECRET: test-secret
        run: npm run test:cov

      - name: Build Backend
        working-directory: ./backend
        run: npm run build

      # å‰ç«¯æ„å»º
      - name: Setup Frontend
        working-directory: ./frontend
        run: npm ci

      - name: Build Frontend
        working-directory: ./frontend
        run: npm run build:h5

      # Docker æ„å»º
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and Push Backend
        uses: docker/build-push-action@v4
        with:
          context: ./backend
          push: true
          tags: |
            yourusername/stardust-backend:latest
            yourusername/stardust-backend:${{ github.sha }}

      - name: Build and Push Frontend
        uses: docker/build-push-action@v4
        with:
          context: ./frontend
          file: ./frontend/Dockerfile.h5
          push: true
          tags: |
            yourusername/stardust-frontend:latest
            yourusername/stardust-frontend:${{ github.sha }}

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Deploy to Production
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PROD_HOST }}
          username: ${{ secrets.PROD_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /opt/stardust
            docker-compose -f docker-compose.prod.yml pull
            docker-compose -f docker-compose.prod.yml up -d --remove-orphans
            docker system prune -f
```

---

## â˜ï¸ äº‘æœåŠ¡å•†éƒ¨ç½²æ–¹æ¡ˆ

### ä¸€ã€é˜¿é‡Œäº‘éƒ¨ç½²æ–¹æ¡ˆ

#### 1.1 èµ„æºé…ç½®
```
ECS å®ä¾‹:
  - é…ç½®: 2æ ¸4G (ç”Ÿäº§ç¯å¢ƒå»ºè®® 4æ ¸8G)
  - ç³»ç»Ÿ: Ubuntu 20.04 LTS
  - å¸¦å®½: 5Mbps (æ ¹æ®æµé‡è°ƒæ•´)
  - ä»·æ ¼: ~Â¥200/æœˆ (æŒ‰é‡ä»˜è´¹)

RDS PostgreSQL:
  - é…ç½®: 2æ ¸4G
  - å­˜å‚¨: 100GB (è‡ªåŠ¨æ‰©å®¹)
  - ç‰ˆæœ¬: PostgreSQL 15
  - ä»·æ ¼: ~Â¥400/æœˆ

Redis:
  - é…ç½®: 1GB
  - ç‰ˆæœ¬: Redis 7
  - ä»·æ ¼: ~Â¥100/æœˆ

OSS å¯¹è±¡å­˜å‚¨:
  - å­˜å‚¨: 50GB
  - æµé‡: 100GB/æœˆ
  - ä»·æ ¼: ~Â¥50/æœˆ

CDN:
  - æµé‡: 100GB/æœˆ
  - ä»·æ ¼: ~Â¥20/æœˆ

æ€»è®¡: ~Â¥770/æœˆ
```

#### 1.2 éƒ¨ç½²æ­¥éª¤
```bash
# 1. è´­ä¹°å¹¶é…ç½® ECS
# - å¼€æ”¾ç«¯å£: 80, 443, 3000 (å¯é€‰)
# - é…ç½®å®‰å…¨ç»„è§„åˆ™

# 2. è¿æ¥æœåŠ¡å™¨
ssh root@your-ecs-ip

# 3. å®‰è£…åŸºç¡€è½¯ä»¶
apt update
apt install -y docker.io docker-compose git

# 4. å…‹éš†ä»£ç 
git clone https://github.com/yourusername/stardust.git /opt/stardust

# 5. é…ç½®ç¯å¢ƒå˜é‡
cd /opt/stardust
cp .env.example .env.prod
# ç¼–è¾‘ .env.prod å¡«å…¥çœŸå®é…ç½®

# 6. éƒ¨ç½²
docker-compose -f docker-compose.prod.yml up -d

# 7. é…ç½® SSL (ä½¿ç”¨ Let's Encrypt)
docker run -it --rm \
  -v /opt/stardust/ssl:/etc/letsencrypt \
  certbot/certbot certonly --nginx -d stardust.app -d www.stardust.app
```

#### 1.3 åŸŸåä¸ SSL
```
åŸŸåè´­ä¹°: é˜¿é‡Œäº‘åŸŸå
  - stardust.app (Â¥50/å¹´)
  - æ˜Ÿå°˜.app (Â¥50/å¹´)

SSL è¯ä¹¦:
  - Let's Encrypt (å…è´¹)
  - è‡ªåŠ¨ç»­æœŸè„šæœ¬

CDN é…ç½®:
  - å¼€å¯ Gzip
  - é…ç½®ç¼“å­˜ç­–ç•¥
  - å¼€å¯ HTTPS
```

### äºŒã€è…¾è®¯äº‘éƒ¨ç½²æ–¹æ¡ˆ

#### 2.1 èµ„æºé…ç½®
```
CVM å®ä¾‹:
  - é…ç½®: 2æ ¸4G
  - ç³»ç»Ÿ: Ubuntu 20.04
  - å¸¦å®½: 5Mbps
  - ä»·æ ¼: ~Â¥180/æœˆ

PostgreSQL:
  - é…ç½®: 2æ ¸4G
  - å­˜å‚¨: 100GB
  - ä»·æ ¼: ~Â¥380/æœˆ

Redis:
  - é…ç½®: 1GB
  - ä»·æ ¼: ~Â¥90/æœˆ

COS å¯¹è±¡å­˜å‚¨:
  - å­˜å‚¨: 50GB
  - ä»·æ ¼: ~Â¥40/æœˆ

CDN:
  - æµé‡: 100GB/æœˆ
  - ä»·æ ¼: ~Â¥20/æœˆ

æ€»è®¡: ~Â¥710/æœˆ
```

#### 2.2 éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# deploy.sh

set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½² StarDust..."

# æ‹‰å–æœ€æ–°ä»£ç 
cd /opt/stardust
git pull origin main

# æ„å»ºå‰ç«¯
cd frontend
docker build -t stardust-frontend:latest -f Dockerfile.h5 .

# æ„å»ºåç«¯
cd ../backend
docker build -t stardust-backend:latest .

# åœæ­¢æ—§å®¹å™¨
cd ..
docker-compose -f docker-compose.prod.yml down

# å¯åŠ¨æ–°å®¹å™¨
docker-compose -f docker-compose.prod.yml up -d

# æ¸…ç†æ—§é•œåƒ
docker image prune -f

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
```

### ä¸‰ã€AWS éƒ¨ç½²æ–¹æ¡ˆ (å›½é™…ç‰ˆ)

#### 3.1 èµ„æºé…ç½®
```
EC2 (åº”ç”¨æœåŠ¡å™¨):
  - å®ä¾‹: t3.medium (2æ ¸4G)
  - ç³»ç»Ÿ: Amazon Linux 2
  - ä»·æ ¼: ~$30/æœˆ

RDS (æ•°æ®åº“):
  - å®ä¾‹: db.t3.micro
  - å¼•æ“: PostgreSQL 15
  - ä»·æ ¼: ~$15/æœˆ

ElastiCache (Redis):
  - å®ä¾‹: cache.t3.micro
  - ä»·æ ¼: ~$10/æœˆ)

S3 (å¯¹è±¡å­˜å‚¨):
  - å­˜å‚¨: 50GB
  - æµé‡: 100GB
  - ä»·æ ¼: ~$5/æœˆ

CloudFront (CDN):
  - æµé‡: 100GB
  - ä»·æ ¼: ~$10/æœˆ

æ€»è®¡: ~$70/æœˆ
```

#### 3.2 éƒ¨ç½²æµç¨‹
```bash
# 1. é…ç½® AWS CLI
aws configure

# 2. åˆ›å»º ECS é›†ç¾¤
aws ecs create-cluster --cluster-name stardust-cluster

# 3. æ¨é€é•œåƒåˆ° ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <account-id>.dkr.ecr.us-east-1.amazonaws.com

docker tag stardust-backend:latest <account-id>.dkr.ecr.us-east-1.amazonaws.com/stardust-backend:latest
docker push <account-id>.dkr.ecr.us-east-1.amazonaws.com/stardust-backend:latest

# 4. éƒ¨ç½²æœåŠ¡
aws ecs create-service --cluster stardust-cluster --service-name backend-service --task-definition backend-task
```

---

## ğŸ“± å„å¹³å°å‘å¸ƒæµç¨‹

### ä¸€ã€H5 ç½‘ç«™å‘å¸ƒ

#### 1.1 åŸŸåä¸ CDN é…ç½®
```
åŸŸå: stardust.app
SSL: Let's Encrypt (è‡ªåŠ¨ç»­æœŸ)

CDN é…ç½®:
  - é˜¿é‡Œäº‘ CDN / Cloudflare
  - ç¼“å­˜ç­–ç•¥:
    * HTML: no-cache
    * JS/CSS: 1å¹´
    * å›¾ç‰‡: 1å‘¨
  - å¼€å¯ Gzip/Brotli
  - å¼€å¯ HTTP/2
  - é…ç½®å®‰å…¨é˜²æŠ¤ (WAF)

DNS é…ç½®:
  A è®°å½•: stardust.app -> æœåŠ¡å™¨ IP
  CNAME: www -> stardust.app
```

#### 1.2 éƒ¨ç½²æ£€æŸ¥æ¸…å•
```bash
â–¡ åŸŸåè§£æç”Ÿæ•ˆ
â–¡ SSL è¯ä¹¦å®‰è£…
â–¡ CDN é…ç½®å®Œæˆ
â–¡ é¦–é¡µåŠ è½½æµ‹è¯• (< 2s)
â–¡ API æ¥å£æµ‹è¯•
â–¡ ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•
â–¡ å¾®ä¿¡åˆ†äº«æµ‹è¯•
â–¡ ç™¾åº¦æ”¶å½•æäº¤
â–¡ Google Analytics é…ç½®
â–¡ é”™è¯¯ç›‘æ§é…ç½® (Sentry)
```

### äºŒã€å¾®ä¿¡å°ç¨‹åºå‘å¸ƒ

#### 2.1 å¼€å‘å‡†å¤‡
```
å°ç¨‹åºè´¦å·:
  - æ³¨å†Œå°ç¨‹åºè´¦å· (https://mp.weixin.qq.com)
  - ä¼ä¸šè®¤è¯ (Â¥300/å¹´)
  - å¼€é€šæ”¯ä»˜åŠŸèƒ½ (éœ€ä¼ä¸šèµ„è´¨)

å¼€å‘é…ç½®:
  - AppID: wxxxxxxxxxxxxxxxx
  - æœåŠ¡å™¨åŸŸåé…ç½®:
    * requeståˆæ³•åŸŸå: https://api.stardust.app
    * socketåˆæ³•åŸŸå: wss://api.stardust.app
    * uploadFileåŸŸå: https://api.stardust.app
    * downloadFileåŸŸå: https://api.stardust.app

éšç§åè®®:
  - é…ç½®ç”¨æˆ·éšç§ä¿æŠ¤æŒ‡å¼•
  - å£°æ˜æ”¶é›†çš„ç”¨æˆ·ä¿¡æ¯
```

#### 2.2 æ„å»ºä¸ä¸Šä¼ 
```bash
# 1. æ„å»ºå°ç¨‹åº
cd frontend
npm run build:mp-weixin

# 2. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·
# - æ‰“å¼€ dist/build/mp-weixin ç›®å½•
# - é¢„è§ˆæµ‹è¯•
# - ä¸Šä¼ ä»£ç 

# 3. æäº¤å®¡æ ¸
# - å¡«å†™ç‰ˆæœ¬æè¿°
# - é€‰æ‹©ä½“éªŒç‰ˆ
# - æäº¤å®¡æ ¸

# 4. å®¡æ ¸é€šè¿‡åå‘å¸ƒ
```

#### 2.3 å®¡æ ¸æ³¨æ„äº‹é¡¹
```
å†…å®¹åˆè§„:
  â–¡ é¿å…å°å»ºè¿·ä¿¡è¯æ±‡
  â–¡ ä½¿ç”¨"æ–‡åŒ–"ã€"å¨±ä¹"ã€"å‚è€ƒ"ç­‰è¡¨è¿°
  â–¡ æ·»åŠ å…è´£å£°æ˜: "ä»…ä¾›å¨±ä¹å‚è€ƒ"

åŠŸèƒ½åˆè§„:
  â–¡ ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–
  â–¡ æ”¯ä»˜åŠŸèƒ½åˆè§„
  â–¡ ç”¨æˆ·æŠ•è¯‰å¤„ç†æœºåˆ¶

ç•Œé¢è§„èŒƒ:
  â–¡ ä¸ä½¿ç”¨å®˜æ–¹ UI æ ·å¼
  â–¡ ä¸è¯±å¯¼åˆ†äº«
  â–¡ ä¸æ»¥ç”¨é€šçŸ¥
```

#### 2.4 å‘å¸ƒæ£€æŸ¥æ¸…å•
```bash
â–¡ ä»£ç å®¡æ ¸é€šè¿‡
â–¡ æœåŠ¡å™¨åŸŸåé…ç½®
â–¡ éšç§åè®®é…ç½®
â–¡ æ”¯ä»˜åŠŸèƒ½æµ‹è¯•
â–¡ ç”¨æˆ·ç™»å½•æµ‹è¯•
â–¡ åˆ†äº«åŠŸèƒ½æµ‹è¯•
â–¡ æ¶ˆæ¯æ¨é€æµ‹è¯•
â–¡ æ•°æ®ä¸ŠæŠ¥é…ç½®
â–¡ é”™è¯¯ç›‘æ§é…ç½®
â–¡ ç‰ˆæœ¬å›æ»šæ–¹æ¡ˆ
```

### ä¸‰ã€æŠ–éŸ³å°ç¨‹åºå‘å¸ƒ

#### 3.1 å¼€å‘å‡†å¤‡
```
å°ç¨‹åºè´¦å·:
  - æ³¨å†ŒæŠ–éŸ³å°ç¨‹åºè´¦å· (https://microapp.bytedance.com)
  - ä¼ä¸šè®¤è¯
  - å¼€é€šæ”¯ä»˜åŠŸèƒ½

å¼€å‘é…ç½®:
  - AppID: ttxxxxxxxxxxxxxxx
  - æœåŠ¡å™¨åŸŸå:
    * APIåŸŸå: https://api.stardust.app
    * WebSocketåŸŸå: wss://api.stardust.app
```

#### 3.2 æ„å»ºä¸ä¸Šä¼ 
```bash
# 1. æ„å»ºæŠ–éŸ³å°ç¨‹åº
cd frontend
npm run build:mp-toutiao

# 2. ä½¿ç”¨å­—èŠ‚å¼€å‘è€…å·¥å…·
# - æ‰“å¼€ dist/build/mp-toutiao
# - é¢„è§ˆæµ‹è¯•
# - ä¸Šä¼ ä»£ç 

# 3. æäº¤å®¡æ ¸
# - å¡«å†™ç‰ˆæœ¬ä¿¡æ¯
# - é€‰æ‹©å‘å¸ƒèŒƒå›´
# - æäº¤å®¡æ ¸
```

#### 3.3 æŠ–éŸ³ç‰¹æ€§é€‚é…
```
çŸ­è§†é¢‘è”åŠ¨:
  - ç”Ÿæˆæ˜Ÿåº§çŸ­è§†é¢‘
  - ä¸€é”®å‘å¸ƒåˆ°æŠ–éŸ³
  - æŒ‘æˆ˜èµ›æ´»åŠ¨

ç›´æ’­åŠŸèƒ½:
  - å‘½ç†å¸ˆç›´æ’­
  - æƒ…æ„Ÿå’¨è¯¢ç›´æ’­
  - äº’åŠ¨æ‰“èµ

ç®—æ³•æ¨è:
  - ä¼˜åŒ–å†…å®¹æ ‡ç­¾
  - æé«˜å®Œæ’­ç‡
  - å¢åŠ äº’åŠ¨
```

### å››ã€App å‘å¸ƒ

#### 4.1 iOS App Store å‘å¸ƒ

**å‡†å¤‡å·¥ä½œ**
```
Apple å¼€å‘è€…è´¦å·:
  - æ³¨å†Œ: https://developer.apple.com
  - è´¹ç”¨: $99/å¹´
  - ä¼ä¸šè®¤è¯

è¯ä¹¦é…ç½®:
  - App ID: com.stardust.app
  - è¯ä¹¦: Distribution Certificate
  - æè¿°æ–‡ä»¶: Provisioning Profile
```

**æ„å»ºä¸æ‰“åŒ…**
```bash
# 1. é…ç½® manifest.json
# - App å›¾æ ‡ (1024x1024)
# - å¯åŠ¨å›¾
# - åº”ç”¨åç§°
# - ç‰ˆæœ¬å·

# 2. ä½¿ç”¨ HBuilderX æˆ– CLI
cd frontend
npm run build:app

# 3. ç”Ÿæˆ IPA
# - ä½¿ç”¨ HBuilderX æ‰“åŒ…
# - é€‰æ‹© "å‘è¡Œ" -> "App Store åŒ…"
# - å¡«å†™è¯ä¹¦ä¿¡æ¯

# 4. ä¸Šä¼ åˆ° App Store Connect
# - ä½¿ç”¨ Transporter å·¥å…·
# - å¡«å†™å…ƒæ•°æ®
```

**App Store å®¡æ ¸**
```
å®¡æ ¸ä¿¡æ¯:
  - åº”ç”¨åç§°: æ˜Ÿå°˜
  - å‰¯æ ‡é¢˜: æ˜Ÿåº§å åœä¸æƒ…æ„Ÿç¤¾äº¤
  - å…³é”®è¯: æ˜Ÿåº§,å åœ,æƒ…æ„Ÿ,ç¤¾äº¤,è¿åŠ¿
  - æè¿°: è¯¦ç»†åŠŸèƒ½ä»‹ç»
  - æˆªå›¾: 5.5è‹±å¯¸å’Œ6.5è‹±å¯¸

éšç§æ”¿ç­–:
  - éœ€è¦æä¾›éšç§æ”¿ç­–ç½‘å€
  - è¯¦ç»†è¯´æ˜æ•°æ®æ”¶é›†ç”¨é€”
  - ç”¨æˆ·æ•°æ®åˆ é™¤è¯´æ˜

å®¡æ ¸æ³¨æ„äº‹é¡¹:
  â–¡ ä¸èƒ½åŒ…å«å®—æ•™è¿·ä¿¡å†…å®¹
  â–¡ éœ€è¦æ˜ç¡®çš„å…è´£å£°æ˜
  â–¡ ç”¨æˆ·æ•°æ®å®‰å…¨
  â–¡ æ”¯ä»˜åŠŸèƒ½åˆè§„
  â–¡ æ— å´©æºƒå’ŒBug
```

#### 4.2 Android å¤šæ¸ é“å‘å¸ƒ

**Google Play (å›½é™…)**
```bash
# 1. Google Play å¼€å‘è€…è´¦å·
# - æ³¨å†Œ: https://play.google.com/console
# - è´¹ç”¨: $25 ä¸€æ¬¡æ€§
# - ä¼ä¸šè®¤è¯

# 2. æ„å»º AAB (Android App Bundle)
cd frontend
npm run build:app

# 3. ç­¾å
# - ç”Ÿæˆç­¾åå¯†é’¥
# - é…ç½® build.json

# 4. ä¸Šä¼ åˆ° Google Play
# - å¡«å†™å•†åº—ä¿¡æ¯
# - å†…å®¹åˆ†çº§é—®å·
# - æäº¤å®¡æ ¸
```

**å›½å†…åº”ç”¨å•†åº—**
```
åº”ç”¨å•†åº—:
  - åº”ç”¨å® (è…¾è®¯)
  - åä¸ºåº”ç”¨å¸‚åœº
  - å°ç±³åº”ç”¨å•†åº—
  - OPPO è½¯ä»¶å•†åº—
  - vivo åº”ç”¨å•†åº—
  - 360 æ‰‹æœºåŠ©æ‰‹

å„å•†åº—è¦æ±‚:
  â–¡ ä¼ä¸šè¥ä¸šæ‰§ç…§
  â–¡ è½¯ä»¶è‘—ä½œæƒ
  â–¡ ICP å¤‡æ¡ˆ
  â–¡ éšç§æ”¿ç­–
  â–¡ åº”ç”¨è¯´æ˜

å‘å¸ƒæµç¨‹:
  1. æ³¨å†Œå„å•†åº—å¼€å‘è€…è´¦å·
  2. æäº¤åº”ç”¨å®¡æ ¸
  3. ç­‰å¾…å®¡æ ¸ (1-7å¤©)
  4. ä¸Šçº¿å‘å¸ƒ
```

---

## ğŸ› ï¸ è¿ç»´ç›‘æ§

### ä¸€ã€ç›‘æ§ä½“ç³»

#### 1.1 ç³»ç»Ÿç›‘æ§ (Prometheus + Grafana)
```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'backend'
    static_configs:
      - targets: ['backend:3000']
    metrics_path: '/metrics'

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']

  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']

  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:80']
```

**ç›‘æ§æŒ‡æ ‡**
```
ç³»ç»ŸæŒ‡æ ‡:
  - CPU ä½¿ç”¨ç‡ (>80% å‘Šè­¦)
  - å†…å­˜ä½¿ç”¨ç‡ (>80% å‘Šè­¦)
  - ç£ç›˜ä½¿ç”¨ç‡ (>85% å‘Šè­¦)
  - ç½‘ç»œæµé‡

åº”ç”¨æŒ‡æ ‡:
  - API å“åº”æ—¶é—´ (<500ms)
  - é”™è¯¯ç‡ (<1%)
  - å¹¶å‘è¿æ¥æ•°
  - è¯·æ±‚ååé‡

æ•°æ®åº“æŒ‡æ ‡:
  - è¿æ¥æ•°
  - æŸ¥è¯¢æ€§èƒ½
  - ç¼“å­˜å‘½ä¸­ç‡
  - ä¸»ä»å»¶è¿Ÿ

Redis æŒ‡æ ‡:
  - å†…å­˜ä½¿ç”¨
  - å‘½ä¸­ç‡
  - é”®æ•°é‡
  - æ…¢æŸ¥è¯¢
```

#### 1.2 åº”ç”¨ç›‘æ§ (Sentry)
```javascript
// backend/src/main.ts
import * as Sentry from '@sentry/node';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
});

// å‰ç«¯ç›‘æ§
// frontend/src/main.ts
import * as Sentry from '@sentry/vue';

Sentry.init({
  app,
  dsn: process.env.SENTRY_DSN,
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay()
  ],
  tracesSampleRate: 1.0,
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
});
```

#### 1.3 æ—¥å¿—ç³»ç»Ÿ
```bash
# ä½¿ç”¨ ELK Stack æˆ– Loki

# æ—¥å¿—æ”¶é›†é…ç½®
docker run -d \
  --name logstash \
  -p 5000:5000 \
  -v /opt/stardust/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \
  docker.elastic.co/logstash/logstash:8.0.0
```

**æ—¥å¿—çº§åˆ«**
```
ERROR: ç³»ç»Ÿé”™è¯¯ï¼Œç«‹å³å¤„ç†
WARN: è­¦å‘Šä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨
INFO: é‡è¦æ“ä½œè®°å½•
DEBUG: è°ƒè¯•ä¿¡æ¯
```

### äºŒã€å‘Šè­¦é…ç½®

#### 2.1 å‘Šè­¦è§„åˆ™
```yaml
# alert-rules.yml

groups:
  - name: backend
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "é«˜é”™è¯¯ç‡"
          description: "é”™è¯¯ç‡è¶…è¿‡ 5%"

      - alert: SlowResponse
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å“åº”ç¼“æ…¢"
          description: "95% è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡ 1ç§’"

  - name: database
    rules:
      - alert: DatabaseDown
        expr: up{job="postgres"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "æ•°æ®åº“å®•æœº"
```

#### 2.2 å‘Šè­¦æ¸ é“
```
å‘Šè­¦æ–¹å¼:
  - é’‰é’‰/ä¼ä¸šå¾®ä¿¡
  - é‚®ä»¶
  - çŸ­ä¿¡ (ç´§æ€¥)
  - ç”µè¯ (ä¸¥é‡)

å‘Šè­¦åˆ†çº§:
  - P0 (ç´§æ€¥): ç”µè¯+çŸ­ä¿¡+é‚®ä»¶
  - P1 (ä¸¥é‡): çŸ­ä¿¡+é‚®ä»¶
  - P2 (ä¸€èˆ¬): é‚®ä»¶+é’‰é’‰
```

### ä¸‰ã€å¤‡ä»½ç­–ç•¥

#### 3.1 æ•°æ®åº“å¤‡ä»½
```bash
#!/bin/bash
# backup-db.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/postgresql"
FILENAME="stardust_${DATE}.sql"

# å…¨é‡å¤‡ä»½
pg_dump -h db -U user -d stardust > ${BACKUP_DIR}/${FILENAME}

# å‹ç¼©
gzip ${BACKUP_DIR}/${FILENAME}

# ä¸Šä¼ åˆ° OSS
ossutil cp ${BACKUP_DIR}/${FILENAME}.gz oss://stardust-backups/db/

# ä¿ç•™æœ€è¿‘7å¤©
find ${BACKUP_DIR} -name "*.sql.gz" -mtime +7 -delete

# å‘é€é€šçŸ¥
echo "æ•°æ®åº“å¤‡ä»½å®Œæˆ: ${FILENAME}.gz" | mail -s "å¤‡ä»½é€šçŸ¥" admin@stardust.app
```

**å¤‡ä»½è®¡åˆ’**
```
å…¨é‡å¤‡ä»½: æ¯å¤©å‡Œæ™¨ 2:00
å¢é‡å¤‡ä»½: æ¯å°æ—¶
ä¿ç•™å‘¨æœŸ: 7å¤©æœ¬åœ°ï¼Œ30å¤©äº‘ç«¯
æ¢å¤æµ‹è¯•: æ¯æœˆä¸€æ¬¡
```

#### 3.2 ä»£ç å¤‡ä»½
```
Git ä»“åº“: GitHub / GitLab
  - ä¸»åˆ†æ”¯ä¿æŠ¤
  - PR å®¡æŸ¥æœºåˆ¶
  - å®šæœŸå¿«ç…§

é…ç½®å¤‡ä»½:
  - Docker Compose æ–‡ä»¶
  - ç¯å¢ƒå˜é‡
  - Nginx é…ç½®
  - æ•°æ®åº“ Schema
```

---

## ğŸš€ å‘å¸ƒè®¡åˆ’æ—¶é—´è¡¨

### ç¬¬ä¸€é˜¶æ®µ: MVP å‘å¸ƒ (ç¬¬1ä¸ªæœˆ)

#### Week 1-2: å¼€å‘å®Œæˆ
```
â–¡ å‰ç«¯: é¦–é¡µã€ç™»å½•ã€æ˜Ÿç›˜è®¡ç®—ã€ç¥ˆæ„¿
â–¡ åç«¯: ç”¨æˆ·ã€è®¤è¯ã€æ˜Ÿç›˜ã€ç¥ˆæ„¿ API
â–¡ æ•°æ®åº“: è¡¨ç»“æ„ã€ç´¢å¼•
â–¡ æµ‹è¯•: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•
```

#### Week 3: æµ‹è¯•ç¯å¢ƒéƒ¨ç½²
```
â–¡ æµ‹è¯•ç¯å¢ƒæ­å»º
â–¡ è‡ªåŠ¨åŒ–æµ‹è¯•
â–¡ Bug ä¿®å¤
â–¡ æ€§èƒ½æµ‹è¯•
```

#### Week 4: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```
â–¡ ç”Ÿäº§ç¯å¢ƒæ­å»º
â–¡ å‹åŠ›æµ‹è¯•
â–¡ å®‰å…¨æ£€æŸ¥
â–¡ ç›‘æ§é…ç½®
â–¡ ç°åº¦å‘å¸ƒ (10% ç”¨æˆ·)
```

### ç¬¬äºŒé˜¶æ®µ: åŠŸèƒ½å®Œå–„ (ç¬¬2ä¸ªæœˆ)

#### Week 5-6: æ–°åŠŸèƒ½å¼€å‘
```
â–¡ æœˆè€çº¢çº¿
â–¡ æ ‘æ´ç¤¾åŒº
â–¡ ç¼˜åˆ†åŒ¹é…
â–¡ å®æ—¶èŠå¤©
```

#### Week 7: å¤šç«¯å‘å¸ƒ
```
â–¡ H5 ç½‘ç«™æ­£å¼ä¸Šçº¿
â–¡ å¾®ä¿¡å°ç¨‹åºæäº¤å®¡æ ¸
â–¡ æŠ–éŸ³å°ç¨‹åºæäº¤å®¡æ ¸
â–¡ App æ‰“åŒ…æµ‹è¯•
```

#### Week 8: è¿è¥å¯åŠ¨
```
â–¡ å†…å®¹ç”Ÿäº§å¯åŠ¨
â–¡ KOC æ‹›å‹Ÿ
â–¡ ç¤¾ç¾¤å»ºç«‹
â–¡ æ•°æ®ç›‘æ§
```

### ç¬¬ä¸‰é˜¶æ®µ: æ­£å¼æ¨å¹¿ (ç¬¬3-6ä¸ªæœˆ)

#### Month 3: å¢é•¿æœŸ
```
â–¡ å…¨æ¸ é“æ¨å¹¿
â–¡ ä»˜è´¹æŠ•æ”¾æµ‹è¯•
â–¡ ä¼šå‘˜ä½“ç³»ä¸Šçº¿
â–¡ æ•°æ®ä¼˜åŒ–
```

#### Month 4-6: æ‰©å¼ æœŸ
```
â–¡ æ‰©å¤§æŠ•æ”¾è§„æ¨¡
â–¡ ä¸“å®¶å…¥é©»
â–¡ ç”µå•†åŠŸèƒ½
â–¡ çº¿ä¸‹æ´»åŠ¨
â–¡ å“ç‰Œåˆä½œ
```

---

## ğŸ“Š å‘å¸ƒæ£€æŸ¥æ¸…å•

### å‘å¸ƒå‰æ£€æŸ¥
```bash
â–¡ ä»£ç å®¡æŸ¥é€šè¿‡
â–¡ æ‰€æœ‰æµ‹è¯•é€šè¿‡
â–¡ æ–‡æ¡£æ›´æ–°å®Œæˆ
â–¡ æ•°æ®åº“å¤‡ä»½
â–¡ é…ç½®æ–‡ä»¶æ£€æŸ¥
â–¡ ç¯å¢ƒå˜é‡æ£€æŸ¥
â–¡ SSL è¯ä¹¦æœ‰æ•ˆ
â–¡ åŸŸåè§£ææ­£å¸¸
â–¡ CDN é…ç½®å®Œæˆ
â–¡ ç›‘æ§å‘Šè­¦é…ç½®
â–¡ å›æ»šæ–¹æ¡ˆå‡†å¤‡
â–¡ å›¢é˜Ÿé€šçŸ¥åˆ°ä½
```

### å‘å¸ƒä¸­æ£€æŸ¥
```bash
â–¡ å¤‡ä»½å½“å‰ç‰ˆæœ¬
â–¡ é€æ­¥éƒ¨ç½² (è“ç»¿éƒ¨ç½²)
â–¡ å¥åº·æ£€æŸ¥é€šè¿‡
â–¡ æ—¥å¿—ç›‘æ§æ­£å¸¸
â–¡ å…³é”®åŠŸèƒ½æµ‹è¯•
â–¡ æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
â–¡ é”™è¯¯ç‡ç›‘æ§
â–¡ ç”¨æˆ·åé¦ˆç›‘æ§
```

### å‘å¸ƒåæ£€æŸ¥
```bash
â–¡ å…¨é‡å›å½’æµ‹è¯•
â–¡ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
â–¡ æ€§èƒ½å¯¹æ¯”åˆ†æ
â–¡ ç”¨æˆ·åé¦ˆæ”¶é›†
â–¡ é—®é¢˜ä¿®å¤è·Ÿè¿›
â–¡ å‘å¸ƒæŠ¥å‘Šæ€»ç»“
```

---

## ğŸ†˜ åº”æ€¥é¢„æ¡ˆ

### 1. æœåŠ¡å®•æœº
```
ç°è±¡: æœåŠ¡æ— æ³•è®¿é—®

å¤„ç†:
  1. æ£€æŸ¥ Docker å®¹å™¨çŠ¶æ€
  2. æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜
  3. å°è¯•é‡å¯æœåŠ¡
  4. å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
  5. é€šçŸ¥ç”¨æˆ·

é¢„é˜²:
  - å¥åº·æ£€æŸ¥
  - è‡ªåŠ¨é‡å¯
  - è´Ÿè½½å‡è¡¡
```

### 2. æ•°æ®åº“æ•…éšœ
```
ç°è±¡: æ•°æ®åº“è¿æ¥å¤±è´¥/æ•°æ®å¼‚å¸¸

å¤„ç†:
  1. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
  2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
  3. ä»å¤‡ä»½æ¢å¤
  4. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

é¢„é˜²:
  - ä¸»ä»å¤åˆ¶
  - å®šæœŸå¤‡ä»½
  - ç›‘æ§å‘Šè­¦
```

### 3. æ€§èƒ½é—®é¢˜
```
ç°è±¡: å“åº”ç¼“æ…¢/è¶…æ—¶

å¤„ç†:
  1. æŸ¥çœ‹ç›‘æ§æŒ‡æ ‡
  2. åˆ†ææ…¢æŸ¥è¯¢
  3. æ‰©å®¹æˆ–ä¼˜åŒ–
  4. é™æµé™çº§

é¢„é˜²:
  - æ€§èƒ½æµ‹è¯•
  - ç¼“å­˜ç­–ç•¥
  - æ•°æ®åº“ä¼˜åŒ–
```

### 4. å®‰å…¨äº‹ä»¶
```
ç°è±¡: å¼‚å¸¸è®¿é—®/æ•°æ®æ³„éœ²

å¤„ç†:
  1. ç«‹å³éš”ç¦»ç³»ç»Ÿ
  2. ä¿®å¤æ¼æ´
  3. é€šçŸ¥ç”¨æˆ·ä¿®æ”¹å¯†ç 
  4. æŠ¥å‘Šç›‘ç®¡éƒ¨é—¨

é¢„é˜²:
  - å®šæœŸå®‰å…¨æ‰«æ
  - ä»£ç å®‰å…¨å®¡æŸ¥
  - æ•°æ®åŠ å¯†
  - è®¿é—®æ§åˆ¶
```

---

## ğŸ’° æˆæœ¬é¢„ç®—

### é¦–å¹´æ€»æˆæœ¬

#### å¼€å‘æˆæœ¬
```
å‰ç«¯å¼€å‘: Â¥40,000 (2äººÃ—2æœˆ)
åç«¯å¼€å‘: Â¥20,000 (1äººÃ—2æœˆ)
UI/UXè®¾è®¡: Â¥10,000 (1äººÃ—1æœˆ)
æµ‹è¯•: Â¥5,000 (0.5äººÃ—1æœˆ)
å°è®¡: Â¥75,000
```

#### åŸºç¡€è®¾æ–½ (é¦–å¹´)
```
äº‘æœåŠ¡å™¨: Â¥2,400 (Â¥200/æœˆ Ã— 12)
æ•°æ®åº“: Â¥4,800 (Â¥400/æœˆ Ã— 12)
Redis: Â¥1,200 (Â¥100/æœˆ Ã— 12)
å¯¹è±¡å­˜å‚¨: Â¥600 (Â¥50/æœˆ Ã— 12)
CDN: Â¥240 (Â¥20/æœˆ Ã— 12)
åŸŸå: Â¥100
SSLè¯ä¹¦: Â¥500
å°è®¡: Â¥9,840
```

#### è¿è¥æˆæœ¬ (é¦–å¹´)
```
å†…å®¹ç”Ÿäº§: Â¥60,000 (Â¥5,000/æœˆ Ã— 12)
å¹¿å‘ŠæŠ•æ”¾: Â¥120,000 (Â¥10,000/æœˆ Ã— 12)
KOLåˆä½œ: Â¥60,000 (Â¥5,000/æœˆ Ã— 12)
ç¤¾ç¾¤è¿è¥: Â¥24,000 (Â¥2,000/æœˆ Ã— 12)
å°è®¡: Â¥264,000
```

#### å…¶ä»–æˆæœ¬
```
å·¥å…·è½¯ä»¶: Â¥5,000
åº”æ€¥å‚¨å¤‡: Â¥20,000
å°è®¡: Â¥25,000
```

**æ€»è®¡: Â¥373,840**

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### ç¬¬ä¸€å¹´
```
ç”¨æˆ·è§„æ¨¡: 20ä¸‡æ³¨å†Œç”¨æˆ·
ä»˜è´¹ç”¨æˆ·: 1.6ä¸‡ (8%)
ARPU: Â¥50/æœˆ
æœˆæ”¶å…¥: Â¥80ä¸‡
å¹´æ”¶å…¥: Â¥960ä¸‡

ROI: 2.57:1
```

### ç¬¬äºŒå¹´
```
ç”¨æˆ·è§„æ¨¡: 100ä¸‡æ³¨å†Œç”¨æˆ·
ä»˜è´¹ç”¨æˆ·: 10ä¸‡ (10%)
ARPU: Â¥60/æœˆ
æœˆæ”¶å…¥: Â¥600ä¸‡
å¹´æ”¶å…¥: Â¥7200ä¸‡

ROI: 10:1
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### çŸ­æœŸç›®æ ‡ (3ä¸ªæœˆ)
```
â–¡ æ³¨å†Œç”¨æˆ·: 50,000
â–¡ DAU: 5,000
â–¡ ä»˜è´¹è½¬åŒ–: 5%
â–¡ æœˆæ”¶å…¥: Â¥200,000
â–¡ ç”¨æˆ·ç•™å­˜: 40%
```

### ä¸­æœŸç›®æ ‡ (6ä¸ªæœˆ)
```
â–¡ æ³¨å†Œç”¨æˆ·: 200,000
â–¡ DAU: 20,000
â–¡ ä»˜è´¹è½¬åŒ–: 8%
â–¡ æœˆæ”¶å…¥: Â¥1,000,000
â–¡ ç”¨æˆ·ç•™å­˜: 45%
```

### é•¿æœŸç›®æ ‡ (12ä¸ªæœˆ)
```
â–¡ æ³¨å†Œç”¨æˆ·: 500,000
â–¡ DAU: 50,000
â–¡ ä»˜è´¹è½¬åŒ–: 10%
â–¡ æœˆæ”¶å…¥: Â¥3,000,000
â–¡ ç”¨æˆ·ç•™å­˜: 50%
â–¡ å“ç‰ŒçŸ¥ååº¦: è¡Œä¸šå‰å
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-09
**çŠ¶æ€**: è§„åˆ’ä¸­

*æ³¨: æœ¬è®¡åˆ’éœ€æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œå»ºè®®åˆ†é˜¶æ®µå®æ–½ï¼ŒæŒç»­è¿­ä»£ä¼˜åŒ–ã€‚*
