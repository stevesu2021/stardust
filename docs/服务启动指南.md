# Stardust 服务启动指南

## 当前服务状态

### ✅ 后端服务
- **状态**: 已启动
- **地址**: http://localhost:3000
- **数据库**: SQLite (dev.db)
- **端口**: 3000

### ⏳ 前端服务
- **状态**: 正在安装依赖...
- **预计端口**: 8080

## 已启动的后端 API 端点

### 认证接口
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录

### 星座接口
- `POST /api/astrology/calculate/:userId` - 计算星盘

### 祈愿接口
- `POST /api/prayer` - 创建祈愿
- `GET /api/prayer/user/:userId` - 获取用户祈愿
- `GET /api/prayer/public` - 获取公开祈愿
- `POST /api/prayer/increment/:prayerId` - 增加祈福次数

### 表白接口
- `POST /api/confession` - 创建表白
- `GET /api/confession/user/:userId` - 获取用户表白
- `GET /api/confession/public` - 获取公开表白
- `POST /api/confession/match/:confessionId` - 检查匹配

### 树洞接口
- `POST /api/treehole` - 创建树洞
- `GET /api/treehole/user/:userId` - 获取用户树洞
- `GET /api/treehole/public` - 获取公开树洞
- `POST /api/treehole/like/:treeholeId` - 点赞树洞
- `DELETE /api/treehole/:treeholeId` - 删除树洞

### 交友接口
- `POST /api/dating/matches/:userId` - 获取匹配用户
- `POST /api/dating/message` - 发送消息
- `GET /api/dating/messages/:userId/:otherUserId` - 获取聊天记录
- `POST /api/dating/message/read/:messageId` - 标记消息已读

### 用户接口
- `GET /api/user/:id` - 获取用户信息
- `PUT /api/user/:id` - 更新用户信息
- `DELETE /api/user/:id` - 删除用户

## 测试后端服务

### 使用 curl 测试

```bash
# 测试用户注册
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "password123",
    "nickname": "测试用户",
    "gender": "male",
    "birthYear": 1990,
    "birthMonth": 5,
    "birthDay": 15,
    "birthHour": 10
  }'

# 测试用户登录
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "13800138000",
    "password": "password123"
  }'
```

### 使用 Postman 测试

1. 打开 Postman
2. 创建新的请求
3. 设置请求类型为 POST
4. 输入 URL: `http://localhost:3000/api/auth/register`
5. 设置 Headers:
   - `Content-Type`: `application/json`
6. 设置 Body (JSON):
   ```json
   {
     "phone": "13800138000",
     "password": "password123",
     "nickname": "测试用户",
     "gender": "male",
     "birthYear": 1990,
     "birthMonth": 5,
     "birthDay": 15,
     "birthHour": 10
   }
   ```
7. 点击 Send

## 前端服务启动

### 等待依赖安装完成

前端依赖正在安装中，请等待安装完成。

### 启动前端服务

```bash
cd frontend
npm run dev:h5
```

### 前端访问地址

- **H5**: http://localhost:8080
- **微信小程序**: 使用微信开发者工具打开项目
- **抖音小程序**: 使用抖音开发者工具打开项目

## 多端部署说明

### H5 (Web)
```bash
cd frontend
npm run dev:h5
```

### 微信小程序
```bash
cd frontend
npm run dev:mp-weixin
```

### 抖音小程序
```bash
cd frontend
npm run dev:mp-toutiao
```

### Android App
```bash
cd frontend
npm run dev:app
```

### iOS App
```bash
cd frontend
npm run dev:app
```

## 常见问题

### 后端服务无法启动

**问题**: 端口被占用
```bash
# 查找占用端口的进程
lsof -i :3000

# 杀死进程
kill -9 <PID>
```

**问题**: 数据库连接失败
```bash
# 检查数据库文件是否存在
ls -la backend/dev.db

# 重新生成 Prisma Client
cd backend
npx prisma generate
```

### 前端服务无法启动

**问题**: 依赖安装失败
```bash
# 清除缓存重新安装
cd frontend
rm -rf node_modules package-lock.json
npm install
```

**问题**: 端口被占用
```bash
# 修改 vite.config.ts 中的端口
server: {
  port: 8081,  # 修改为其他端口
}
```

## 监控服务状态

### 查看后端日志

后端服务运行在终端 4，查看日志：
```bash
# 后端会自动重启并显示日志
```

### 查看前端日志

前端服务运行在终端 6，查看日志：
```bash
# 前端会显示编译和运行日志
```

## 数据库管理

### 使用 Prisma Studio

```bash
cd backend
npx prisma studio
```

这会在浏览器中打开一个图形化数据库管理界面。

### 查看数据库文件

```bash
# 查看数据库文件
ls -la backend/dev.db

# 使用 SQLite 命令行工具
sqlite3 backend/dev.db
```

## 停止服务

### 停止后端服务

在终端 4 中按 `Ctrl + C`

### 停止前端服务

在终端 6 中按 `Ctrl + C`

## 重启服务

### 重启后端

```bash
cd backend
npm run start:dev
```

### 重启前端

```bash
cd frontend
npm run dev:h5
```

## 生产环境部署

### 后端部署

```bash
cd backend
npm run build
npm run start:prod
```

### 前端部署

```bash
cd frontend
npm run build:h5
# 将 dist 目录部署到服务器
```

## 技术支持

如有问题，请查看：
- [技术选型文档](./技术选型文档.md)
- [开发指南](./开发指南.md)
- [部署指南](./部署指南.md)

## 下一步

1. 等待前端依赖安装完成
2. 启动前端服务
3. 在浏览器中访问 http://localhost:8080
4. 测试各个功能模块
5. 根据需要进行开发和调试

祝使用愉快！